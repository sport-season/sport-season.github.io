{"version":3,"sources":["services/authService.js","components/Profile/index.js","services/activitiesService.js","helpers/formatHelper.js","components/Activities/components/ActivityItem/index.js","components/Activities/index.js","App.js","index.js"],"names":["client_id","client_secret","lsTokenKey","lsUserKey","getAuthLink","searchParams","URLSearchParams","redirect_uri","response_type","approval_prompt","scope","toString","getAuthTokenAsync","a","lsTokenDataStr","localStorage","getItem","length","tData","JSON","parse","expires_at","Date","now","access_token","refresh_token","fetch","body","grant_type","headers","method","then","res","json","result","setItem","stringify","Error","setAuthTokenByCodeAsync","code","console","log","athlete","tokenData","removeItem","Promise","resolve","success","Profile","props","user","src","profile_medium","lastname","firstname","token","t1","t2","Authorization","formatDistance","d","parseFloat","toFixed","ActivityItem","activity","start_date_local","utc_offset","d1","d2","elapsed_time","at","moving_time","href","id","target","name","distance","toLocaleString","substr","toLocaleDateString","toLocaleTimeString","elev_high","elev_low","average_heartrate","max_heartrate","average_speed","speed","defaultD1","getFullYear","defaultD2","Activities","useState","toISOString","setD1","setD2","types","setTypes","type","setType","activities","setActivities","mapRef","useRef","mapContainerRef","useEffect","getActivitiesAsync","Math","floor","reduce","acc","current","L","fullscreenControl","setView","attribution","maxZoom","addTo","boundCoordinates","forEach","summary_polyline","map","coords","polyline","decode","setStyle","color","push","bounds","fitBounds","aggreg","filter","x","val","value","onChange","e","max","Object","entries","v","ref","style","height","App","setToken","window","location","search","get","replace","getUserData","getStoredData","className","onClick","unAuthorizeAsync","reload","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.67240f9e.chunk.js","sourcesContent":["const client_id = 59766;\r\nconst client_secret = 'b7893c2f78225337f8ac6852e5c2fe313948c8f7';\r\nconst lsTokenKey = 'SportSeasonStravaTokenData';\r\nconst lsUserKey = 'SportSeasonStravaUserData';\r\n\r\nexport function getAuthLink() {\r\n    const data = {\r\n        client_id,\r\n        redirect_uri: 'http://localhost:3000/',\r\n        response_type: 'code',\r\n        approval_prompt : 'auto',\r\n        scope: 'activity:read',\r\n        //state: ''\r\n    };\r\n\r\n    const searchParams = new URLSearchParams(data);\r\n\r\n    return `https://www.strava.com/oauth/authorize?${searchParams.toString()}`;\r\n}\r\n\r\nexport async function getAuthTokenAsync() {\r\n    const lsTokenDataStr = localStorage.getItem(lsTokenKey);\r\n\r\n    if (lsTokenDataStr && lsTokenDataStr.length) {\r\n        const tData = JSON.parse(lsTokenDataStr);\r\n        if (tData.expires_at && tData.expires_at * 1000 > Date.now()) {\r\n            return tData.access_token;\r\n        }\r\n\r\n        if (tData.refresh_token) {\r\n            try {\r\n                const result = await fetch(\"https://www.strava.com/api/v3/oauth/token\", {\r\n                    body: new URLSearchParams({\r\n                        client_id,\r\n                        client_secret,\r\n                        refresh_token: tData.refresh_token,\r\n                        grant_type: 'refresh_token'\r\n                    }).toString(),\r\n                    headers: {\r\n                        \"Content-Type\": \"application/x-www-form-urlencoded\"\r\n                    },\r\n                    method: \"POST\"\r\n                }).then(res => res.json());\r\n                localStorage.setItem(lsTokenKey, JSON.stringify(result));\r\n\r\n                return result.access_token;\r\n\r\n            } catch (error) {\r\n                throw new Error(error);\r\n            }\r\n        }\r\n\r\n        throw new Error('no token');\r\n    } else {\r\n        throw new Error('no stored token data');\r\n    }\r\n}\r\n\r\nexport async function setAuthTokenByCodeAsync(code) {\r\n    try {\r\n        const result = await fetch(\"https://www.strava.com/api/v3/oauth/token\", {\r\n            body: new URLSearchParams({\r\n                client_id,\r\n                client_secret,\r\n                code,\r\n                grant_type: 'authorization_code'\r\n            }).toString(),\r\n            headers: {\r\n                \"Content-Type\": \"application/x-www-form-urlencoded\"\r\n            },\r\n            method: \"POST\"\r\n        }).then(res => res.json());\r\n\r\n        console.log({result})\r\n        const { athlete, ...tokenData } = result;\r\n\r\n        localStorage.setItem(lsUserKey, JSON.stringify(athlete));\r\n        localStorage.setItem(lsTokenKey, JSON.stringify(tokenData));\r\n\r\n        return result.access_token;\r\n\r\n    } catch (error) {\r\n        throw new Error(error);\r\n    }\r\n\r\n}\r\n\r\nexport async function unAuthorizeAsync(){\r\n    const access_token = '';\r\n    try {\r\n        await fetch(\r\n            `https://www.strava.com/oauth/deauthorize?${new URLSearchParams({ access_token }).toString()}`,\r\n            { method: \"POST\" }\r\n            ).then(res => res.json());\r\n        localStorage.removeItem(lsTokenKey);\r\n        localStorage.removeItem(lsUserKey);\r\n\r\n        return Promise.resolve({ success: true });\r\n    } catch (error) {\r\n        throw new Error(error);\r\n    }\r\n}\r\n\r\nexport function getUser() {\r\n    return JSON.parse(localStorage.getItem(lsUserKey));\r\n}\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { getUser } from '../../services/authService';\r\n\r\nconst Profile = (props) => {\r\n    const user = getUser();\r\n    return <div>\r\n        <img src={user.profile_medium} />\r\n        {user.lastname}\r\n        {user.firstname}\r\n    </div>;\r\n};\r\n\r\nProfile.propTypes = {};\r\n\r\nexport default Profile;\r\n","export async function getActivitiesAsync(token, t1, t2) {\r\n    return await fetch(`https://www.strava.com/api/v3/athlete/activities?before=${t2}&after=${t1}&page=1&per_page=100`, {\r\n        headers: {\r\n            Authorization: `Bearer ${token}`\r\n        }\r\n    }).then(res => res.json());\r\n\r\n}\r\n","export function formatDistance(d) {\r\n    if (!(d > 0)) { return '-'; }\r\n    return d > 1000 ? `${parseFloat(d / 1000).toFixed(2)}\\u202fкм` : `${parseFloat(d).toFixed()}\\u2009м`;\r\n}\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { act } from '@testing-library/react';\r\nimport { formatDistance } from '../../../../helpers/formatHelper';\r\n\r\nconst ActivityItem = ({ activity }) => {\r\n\r\n    const t1 = Date.parse(activity.start_date_local) - (activity.utc_offset * 1000)\r\n    const d1 = new Date(t1);\r\n    const d2 = new Date(t1 + (activity.elapsed_time * 1000));\r\n    const at = new Date((activity.moving_time - activity.utc_offset ) * 1000);\r\n\r\n    return <div>\r\n        <a href={`https://www.strava.com/activities/${activity.id}`} target={'_blank'}>{activity.name}</a>\r\n        <strong>{formatDistance(activity.distance)}</strong>\r\n        {d1.toLocaleString().substr(0,17)}\r\n        -\r\n        {d1.toLocaleDateString() !== d2.toLocaleDateString() && d2.toLocaleDateString()}\r\n        {d2.toLocaleTimeString().substr(0,5)}\r\n        (движ: {at.toLocaleTimeString().substr(0,5)})\r\n        <br/>\r\n        {activity.elev_high}/{activity.elev_low} {activity.average_heartrate}/{activity.max_heartrate} {activity.average_speed}/{activity.speed}\r\n    </div>;\r\n};\r\n\r\nActivityItem.propTypes = {\r\n    activity: PropTypes.shape({\r\n/*\r\n* achievement_count: 0\r\nathlete: {id: 12602406, resource_state: 1}\r\nathlete_count: 2\r\naverage_cadence: 46.2\r\naverage_heartrate: 109.6\r\naverage_speed: 1.15\r\ncomment_count: 0\r\ncommute: false\r\ndisplay_hide_heartrate_option: true\r\ndistance: 15153.2\r\nelapsed_time: 19210\r\nelev_high: 268.6\r\nelev_low: 171.1\r\nend_latlng: (2) [53.22, 44.91]\r\nexternal_id: \"b1046a83-5025-48bc-81a6-ff2ed5ebf35b-activity.fit\"\r\nflagged: false\r\nfrom_accepted_tag: false\r\ngear_id: \"g6417986\"\r\nhas_heartrate: true\r\nhas_kudoed: false\r\nheartrate_opt_out: false\r\nid: 5872168321\r\nkudos_count: 7\r\nlocation_city: null\r\nlocation_country: \"Russia\"\r\nlocation_state: null\r\nmanual: false\r\nmap: {id: \"a5872168321\", summary_polyline: \"gfzcIyicqGSNJQE_AHAMGDI_@wAEeBN}@\\\\u@KyAjAO@]LM?eCJ…BLu@Km@EoIOq@GeBi@YM}@KMmAV]ZMKGe@a@i@EeAJQlANEh@\", resource_state: 2}\r\nmax_heartrate: 148\r\nmax_speed: 4\r\nmoving_time: 13179\r\nname: \"Полуденная ходьба\"\r\nphoto_count: 0\r\npr_count: 0\r\nprivate: false\r\nresource_state: 2\r\nstart_date: \"2021-08-29T08:14:02Z\"\r\nstart_date_local: \"2021-08-29T11:14:02Z\"\r\nstart_latitude: 53.22\r\nstart_latlng: (2) [53.22, 44.91]\r\nstart_longitude: 44.91\r\ntimezone: \"(GMT+03:00) Europe/Moscow\"\r\ntotal_elevation_gain: 189.2\r\ntotal_photo_count: 16\r\ntrainer: false\r\ntype: \"Walk\"\r\nupload_id: 6243513574\r\nupload_id_str: \"6243513574\"\r\nutc_offset: 10800\r\nvisibility: \"everyone\"\r\n\r\n* */\r\n    }).isRequired,\r\n};\r\n\r\nexport default ActivityItem;\r\n","import React, { useEffect, useState, useRef } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport * as L from 'leaflet';\r\nimport polyline from '@mapbox/polyline';\r\nimport { getActivitiesAsync } from '../../services/activitiesService';\r\nimport ActivityItem from './components/ActivityItem';\r\nimport { formatDistance } from '../../helpers/formatHelper';\r\nconst now = new Date();\r\nconst defaultD1 = new Date(now.getFullYear(), 0, 1, 4, 0, 0, 1);\r\nconst defaultD2 = new Date(now.getFullYear(), 11, 31, 23, 59, 59, 999);\r\n\r\nconst Activities = ({ token }) => {\r\n    const [d1, setD1] = useState(defaultD1.toISOString().substr(0,10));\r\n    const [d2, setD2] = useState(defaultD2.toISOString().substr(0,10));\r\n    const [types, setTypes] = useState([]);\r\n    const [type, setType] = useState();\r\n    const [activities, setActivities] = useState(null);\r\n    const mapRef = useRef();\r\n    const mapContainerRef = useRef();\r\n\r\n    useEffect(() => {\r\n        setActivities(null);\r\n\r\n        getActivitiesAsync(token, Math.floor(Date.parse(d1) / 1000), Math.floor(Date.parse(d2) / 1000))\r\n            .then(res => {\r\n                setActivities(res);\r\n                setTypes(res.reduce((acc, {type}) => ({...acc, [type]: (acc[type] || 0) + 1}), {}));\r\n                console.log(res)\r\n            })\r\n    }, [d1, d2, token]);\r\n\r\n\r\n    useEffect(()=> {\r\n        if (!mapContainerRef?.current || mapRef?.current) {\r\n            return;\r\n        }\r\n        mapRef.current = L.map(\r\n            mapContainerRef.current,\r\n            { fullscreenControl: true }\r\n        ).setView([53.2006600, 45.0046400], 12);\r\n\r\n        L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n            attribution: 'Map data © <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors',\r\n            maxZoom: 20,\r\n            id: 'osm'\r\n        }).addTo(mapRef.current);\r\n\r\n\r\n        const boundCoordinates = [];\r\n\r\n\r\n        activities.forEach(({ map: {summary_polyline} }) => {\r\n            if (summary_polyline?.length) {\r\n                const coords = polyline.decode(summary_polyline);\r\n                L.polyline(coords).setStyle({\r\n                    color: 'rgba(255, 255, 255,0.5)'\r\n                }).addTo(mapRef.current)\r\n                boundCoordinates.push(coords)\r\n            }\r\n        })\r\n\r\n        const bounds = L.latLngBounds(boundCoordinates);\r\n        boundCoordinates?.length && mapRef.current.fitBounds(bounds);// works!\r\n\r\n    }, [mapContainerRef.current, activities]);\r\n\r\n\r\n    const aggreg = activities && activities.filter(x => !type || x.type === type).reduce((acc, val) => {\r\n        return {\r\n            distance: acc.distance + val.distance,\r\n            elev_high: acc.elev_high + val.elev_high || 0,\r\n            elev_low: acc.elev_low + val.elev_low || 0,\r\n            elapsed_time: acc.elapsed_time + val.elapsed_time,\r\n            moving_time: acc.moving_time + val.moving_time\r\n        };\r\n    }, { distance: 0, elev_high: 0, elev_low: 0, elapsed_time: 0, moving_time: 0 })\r\n\r\n    return <div>\r\n        <input type=\"date\" value={d1} onChange={(e) => setD1(e.target.value)}/>-\r\n        <input type=\"date\" value={d2} max={defaultD2.toISOString().substr(0,10)} onChange={(e) => setD2(e.target.value)}/>\r\n        <select onChange={e => setType(e.target.value)} value={type}>\r\n            <option value=\"\">Все виды активностей</option>\r\n            {types && Object.entries(types).map(([x,v]) => (\r\n                <option key={x} value={x}>{x} ({v})</option>\r\n            ))}\r\n        </select>\r\n        <hr />\r\n        {aggreg && <h3>{formatDistance(aggreg.distance)}, ⭧{formatDistance(aggreg.elev_high)}, ⭨{formatDistance(aggreg.elev_low)}, {(aggreg.moving_time / 60 / 60).toFixed(2)} ч.ы</h3>}\r\n        <hr />\r\n        {!activities && 'loading...'}\r\n        {activities && <div ref={mapContainerRef} style={{height:'300px'}}/>}\r\n        <ul>\r\n            {activities && activities.filter(x => !type || x.type === type).map(x => <ActivityItem key={x.id} activity={x} /> )}\r\n        </ul>\r\n    </div>;\r\n};\r\n\r\nActivities.propTypes = {\r\n    token: PropTypes.string,\r\n};\r\n\r\nexport default Activities;\r\n","import { useEffect, useState } from 'react';\r\nimport './App.css';\r\nimport {\r\n    getAuthLink,\r\n    getAuthTokenAsync,\r\n    setAuthTokenByCodeAsync,\r\n    unAuthorizeAsync\r\n} from './services/authService';\r\nimport Profile from './components/Profile';\r\nimport { getActivitiesAsync } from './services/activitiesService';\r\nimport Activities from './components/Activities';\r\n\r\n\r\nfunction App() {\r\n    const [token, setToken] = useState(null);\r\n    useEffect(() => {\r\n        const params = new URLSearchParams(window.location.search);\r\n        const code = params.get('code');\r\n\r\n        if(code?.length) {\r\n            const getUserData = async () => {\r\n                try {\r\n                    await setAuthTokenByCodeAsync(code);\r\n                    window.location.href = window.location.href.replace(window.location.search, '');\r\n                } catch (e) {\r\n                    window.location.href = getAuthLink();\r\n                }\r\n            }\r\n            return getUserData();\r\n        } else {\r\n            const getStoredData = async () => {\r\n                try {\r\n                    const token = await getAuthTokenAsync();\r\n                    setToken(token);\r\n                } catch (e) {\r\n                    console.log(e)\r\n                    //window.location.href = getAuthLink();\r\n                }\r\n            }\r\n\r\n            getStoredData();\r\n        }\r\n\r\n    }, []);\r\n\r\n  return (\r\n    <div className=\"App\">\r\n          {token && <header>\r\n              <Profile />\r\n              <button onClick={() => unAuthorizeAsync().then(() => window.location.reload())}>Выйти</button>\r\n          </header>}\r\n          {!token && <button onClick={() => window.location.href = getAuthLink()}>Войти</button>}\r\n        {token && <Activities token={token} /> }\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n"],"sourceRoot":""}
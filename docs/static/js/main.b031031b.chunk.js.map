{"version":3,"sources":["components/Activities/styles.module.css","services/authService.js","components/Profile/index.js","services/activitiesService.js","helpers/formatHelper.js","components/Activities/components/ActivityItem/index.js","components/Activities/index.js","components/Activities/components/Card/index.js","helpers/mapHelper.js","App.js","index.js","components/Profile/styles.module.css","components/Activities/components/Card/styles.module.css"],"names":["module","exports","client_id","client_secret","lsTokenKey","lsUserKey","getAuthLink","data","redirect_uri","window","location","origin","response_type","approval_prompt","scope","searchParams","URLSearchParams","toString","getAuthTokenAsync","a","lsTokenDataStr","localStorage","getItem","length","tData","JSON","parse","expires_at","Date","now","access_token","refresh_token","fetch","body","grant_type","headers","method","then","res","json","result","setItem","stringify","Error","setAuthTokenByCodeAsync","code","console","log","athlete","tokenData","removeItem","Promise","resolve","success","Profile","props","user","className","styles","prof","src","profile_medium","ava","name","lastname","firstname","token","t1","t2","Authorization","formatDistance","d","parseFloat","toFixed","ActivityItem","activity","start_date_local","utc_offset","d1","d2","elapsed_time","at","moving_time","href","id","target","distance","toLocaleString","substr","toLocaleDateString","toLocaleTimeString","elev_high","elev_low","average_heartrate","max_heartrate","average_speed","speed","debounceTimer","Card","title","children","card","cardTitle","cardContent","defaultD1","getFullYear","defaultD2","Activities","useState","toISOString","setD1","setD2","types","setTypes","type","setType","activities","setActivities","mapRef","useRef","mapContainerRef","useEffect","clearTimeout","setTimeout","getActivitiesAsync","Math","floor","reduce","acc","current","L","fullscreenControl","setView","attribution","maxZoom","addTo","map","boundCoordinates","eachLayer","layer","hasEmptyContrib","getAttribution","hasNoContrib","removeLayer","filter","x","forEach","summary_polyline","coords","polyline","decode","setStyle","color","push","bounds","fitBounds","aggreg","val","form","value","onChange","e","max","Object","entries","v","style","display","ref","height","App","setToken","search","get","replace","getUserData","getStoredData","onClick","unAuthorizeAsync","reload","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"uHACAA,EAAOC,QAAU,CAAC,KAAO,uB,kMCDnBC,EAAY,MACZC,EAAgB,2CAChBC,EAAa,6BACbC,EAAY,4BAEX,SAASC,IACZ,IAAMC,EAAO,CACTL,YACAM,aAAcC,OAAOC,SAASC,OAC9BC,cAAe,OACfC,gBAAkB,OAClBC,MAAO,iBAILC,EAAe,IAAIC,gBAAgBT,GAEzC,MAAM,0CAAN,OAAiDQ,EAAaE,YAG3D,SAAeC,IAAtB,+B,4CAAO,gCAAAC,EAAA,2DACGC,EAAiBC,aAAaC,QAAQlB,MAEtBgB,EAAeG,OAHlC,uBAIOC,EAAQC,KAAKC,MAAMN,IACfO,YAAiC,IAAnBH,EAAMG,WAAoBC,KAAKC,OALxD,yCAMYL,EAAMM,cANlB,WASKN,EAAMO,cATX,0CAW8BC,MAAM,4CAA6C,CACpEC,KAAM,IAAIjB,gBAAgB,CACtBd,YACAC,gBACA4B,cAAeP,EAAMO,cACrBG,WAAY,kBACbjB,WACHkB,QAAS,CACL,eAAgB,qCAEpBC,OAAQ,SACTC,MAAK,SAAAC,GAAG,OAAIA,EAAIC,UAtB5B,cAWeC,EAXf,OAuBSnB,aAAaoB,QAAQrC,EAAYqB,KAAKiB,UAAUF,IAvBzD,kBAyBgBA,EAAOV,cAzBvB,wCA4Be,IAAIa,MAAJ,MA5Bf,cAgCO,IAAIA,MAAM,YAhCjB,cAkCO,IAAIA,MAAM,wBAlCjB,2D,sBAsCA,SAAeC,EAAtB,kC,4CAAO,WAAuCC,GAAvC,mBAAA1B,EAAA,+EAEsBa,MAAM,4CAA6C,CACpEC,KAAM,IAAIjB,gBAAgB,CACtBd,YACAC,gBACA0C,OACAX,WAAY,uBACbjB,WACHkB,QAAS,CACL,eAAgB,qCAEpBC,OAAQ,SACTC,MAAK,SAAAC,GAAG,OAAIA,EAAIC,UAbpB,cAEOC,EAFP,OAeCM,QAAQC,IAAI,CAACP,WACLQ,EAA0BR,EAA1BQ,QAAYC,EAhBrB,YAgBmCT,EAhBnC,GAkBCnB,aAAaoB,QAAQpC,EAAWoB,KAAKiB,UAAUM,IAC/C3B,aAAaoB,QAAQrC,EAAYqB,KAAKiB,UAAUO,IAnBjD,kBAqBQT,EAAOV,cArBf,wCAwBO,IAAIa,MAAJ,MAxBP,2D,kEA6BA,sBAAAxB,EAAA,4DACkB,GADlB,kBAGOa,MAAM,4CAAD,OACqC,IAAIhB,gBAAgB,CAAEc,aAHrD,KAGqEb,YAClF,CAAEmB,OAAQ,SACRC,MAAK,SAAAC,GAAG,OAAIA,EAAIC,UANvB,cAOClB,aAAa6B,WAAW9C,GACxBiB,aAAa6B,WAAW7C,GARzB,kBAUQ8C,QAAQC,QAAQ,CAAEC,SAAS,KAVnC,sCAYO,IAAIV,MAAJ,MAZP,0D,kDCrEQW,EAbC,SAACC,GACb,IAAMC,EDkGC/B,KAAKC,MAAML,aAAaC,QAAQjB,ICjGvC,OAAO,sBAAKoD,UAAWC,IAAOC,KAAvB,UACH,qBAAKC,IAAKJ,EAAKK,eAAgBJ,UAAWC,IAAOI,MACjD,sBAAKL,UAAWC,IAAOK,KAAvB,UACKP,EAAKQ,SACN,iCAASR,EAAKS,mB,sFCXnB,WAAkCC,EAAOC,EAAIC,GAA7C,SAAAjD,EAAA,sEACUa,MAAM,2DAAD,OAA4DoC,EAA5D,kBAAwED,EAAxE,wBAAkG,CAChHhC,QAAS,CACLkC,cAAc,UAAD,OAAYH,MAE9B7B,MAAK,SAAAC,GAAG,OAAIA,EAAIC,UALhB,oF,6BCAA,SAAS+B,EAAeC,GAC3B,OAAMA,EAAI,EACHA,EAAI,IAAJ,UAAcC,WAAWD,EAAI,KAAME,QAAQ,GAA3C,gCAA6DD,WAAWD,GAAGE,UAA3E,gBADgB,ICI3B,IA8EeC,EA9EM,SAAC,GAAkB,IAAhBC,EAAe,EAAfA,SAEdR,EAAKvC,KAAKF,MAAMiD,EAASC,kBAA2C,IAAtBD,EAASE,WACvDC,EAAK,IAAIlD,KAAKuC,GACdY,EAAK,IAAInD,KAAKuC,EAA8B,IAAxBQ,EAASK,cAC7BC,EAAK,IAAIrD,KAAqD,KAA/C+C,EAASO,YAAcP,EAASE,aAErD,OAAO,gCACH,mBAAGM,KAAI,4CAAuCR,EAASS,IAAMC,OAAQ,SAArE,SAAgFV,EAASZ,OACzF,iCAASO,EAAeK,EAASW,YAChCR,EAAGS,iBAAiBC,OAAO,EAAE,IAH3B,IAKFV,EAAGW,uBAAyBV,EAAGU,sBAAwBV,EAAGU,qBAC1DV,EAAGW,qBAAqBF,OAAO,EAAE,GAN/B,8BAOKP,EAAGS,qBAAqBF,OAAO,EAAE,GAPtC,IAQH,uBACCb,EAASgB,UATP,IASmBhB,EAASiB,SAT5B,IASuCjB,EAASkB,kBAThD,IASoElB,EAASmB,cAT7E,IAS6FnB,EAASoB,cATtG,IASsHpB,EAASqB,U,ICRtIC,E,iBCAWC,EATF,SAAC,GAAuB,IAAtBC,EAAqB,EAArBA,MAAOC,EAAc,EAAdA,SAClB,OAAO,sBAAK3C,UAAWC,IAAO2C,KAAvB,UACH,qBAAK5C,UAAWC,IAAO4C,UAAvB,SAAmCH,IACnC,qBAAK1C,UAAWC,IAAO6C,YAAvB,SAAqCH,Q,kBDGvCvE,EAAM,IAAID,KACV4E,EAAY,IAAI5E,KAAKC,EAAI4E,cAAe,EAAG,EAAG,EAAG,EAAG,EAAG,GACvDC,EAAY,IAAI9E,KAAKC,EAAI4E,cAAe,GAAI,GAAI,GAAI,GAAI,GAAI,KAsHnDE,EAnHI,SAAC,GAAe,IAAbzC,EAAY,EAAZA,MAClB,EAAoB0C,mBAASvF,aAAaC,QAAQ,iBAAmBkF,EAAUK,cAAcrB,OAAO,EAAE,KAAtG,mBAAOV,EAAP,KAAWgC,EAAX,KACA,EAAoBF,mBAASvF,aAAaC,QAAQ,iBAAmBoF,EAAUG,cAAcrB,OAAO,EAAE,KAAtG,mBAAOT,EAAP,KAAWgC,EAAX,KACA,EAA0BH,mBAAS,IAAnC,mBAAOI,EAAP,KAAcC,EAAd,KACA,EAAwBL,mBAASvF,aAAaC,QAAQ,mBAAtD,mBAAO4F,EAAP,KAAaC,EAAb,KACA,EAAoCP,mBAAS,MAA7C,mBAAOQ,EAAP,KAAmBC,EAAnB,KACMC,EAASC,mBACTC,EAAkBD,mBAExBE,qBAAU,WAENC,aAAazB,GACbA,EAAgB0B,YAAW,WACvBN,EAAc,MACdhG,aAAaoB,QAAQ,eAAgBqC,GACrCzD,aAAaoB,QAAQ,eAAgBsC,GH9B1C,SAAP,sCGgCY6C,CAAmB1D,EAAO2D,KAAKC,MAAMlG,KAAKF,MAAMoD,GAAM,KAAO+C,KAAKC,MAAMlG,KAAKF,MAAMqD,GAAM,MACpF1C,MAAK,SAAAC,GACF+E,EAAc/E,GACd2E,EAAS3E,EAAIyF,QAAO,SAACC,EAAD,OAAOd,EAAP,EAAOA,KAAP,mBAAC,eAAqBc,GAAtB,kBAA4Bd,GAAQc,EAAId,IAAS,GAAK,MAAK,KAC/EpE,QAAQC,IAAIT,QAGrB,OAEJ,CAACwC,EAAIC,EAAIb,IAEZuD,qBAAU,WACNpG,aAAaoB,QAAQ,iBAAkByE,KACxC,CAACA,IAGJO,qBAAU,WACN,GAAI,OAACD,QAAD,IAACA,OAAD,EAACA,EAAiBS,QAAtB,EAII,OAACX,QAAD,IAACA,OAAD,EAACA,EAAQW,WACTX,EAAOW,QAAUC,MACbV,EAAgBS,QAChB,CAAEE,mBAAmB,IACvBC,QAAQ,CAAC,SAAY,UAAa,IAEpCF,YAAY,oDAAqD,CAC7DG,YAAa,kFACbC,QAAS,GACTlD,GAAI,QACLmD,MAAMjB,EAAOW,UAKpB,IEpEiBO,EFoEXC,EAAmB,IEpERD,EFsERlB,EAAOW,SErEhBS,WAAU,SAACC,GACX,IAAMC,IAAoBD,EAAME,gBAAkBF,EAAME,kBAClDC,GAAgBH,EAAME,gBACxBD,GAAmBE,IACnBN,EAAIO,YAAYJ,MFkEpBvB,EAAW4B,QAAO,SAAAC,GAAC,OAAK/B,GAAQ+B,EAAE/B,OAASA,KAAMgC,SAAQ,YAAkC,IAAzBC,EAAwB,EAA9BX,IAAMW,iBAC9D,UAAIA,QAAJ,IAAIA,OAAJ,EAAIA,EAAkB5H,OAAQ,CAC1B,IAAM6H,EAASC,IAASC,OAAOH,GAC/BjB,WAAWkB,GAAQG,SAAS,CACxBC,MAAO,wBACRjB,MAAMjB,EAAOW,SAChBQ,EAAiBgB,KAAKL,OAI9B,IAAMM,EAASxB,eAAeO,IACd,OAAhBA,QAAgB,IAAhBA,OAAA,EAAAA,EAAkBlH,SAAU+F,EAAOW,QAAQ0B,UAAUD,MAEtD,CAAClC,EAAgBS,QAASb,EAAYF,IAGzC,IAAM0C,EAASxC,GAAcA,EAAW4B,QAAO,SAAAC,GAAC,OAAK/B,GAAQ+B,EAAE/B,OAASA,KAAMa,QAAO,SAACC,EAAK6B,GACvF,MAAO,CACHvE,SAAU0C,EAAI1C,SAAWuE,EAAIvE,SAC7BK,UAAWqC,EAAIrC,UAAYkE,EAAIlE,WAAa,EAC5CC,SAAUoC,EAAIpC,SAAWiE,EAAIjE,UAAY,EACzCZ,aAAcgD,EAAIhD,aAAe6E,EAAI7E,aACrCE,YAAa8C,EAAI9C,YAAc2E,EAAI3E,eAExC,CAAEI,SAAU,EAAGK,UAAW,EAAGC,SAAU,EAAGZ,aAAc,EAAGE,YAAa,IAK3E,OAAO,gCACH,sBAAKzB,UAAWC,IAAOoG,KAAvB,UAA6B,uBAAO5C,KAAK,OAAO6C,MAAOjF,EAAIkF,SAJ1C,SAACC,GAAD,OAAOnD,EAAMmD,EAAE5E,OAAO0E,UAIvC,IACA,uBAAO7C,KAAK,OAAO6C,MAAOhF,EAAImF,IAAKxD,EAAUG,cAAcrB,OAAO,EAAE,IAAKwE,SAJxD,SAACC,GAAD,OAAOlD,EAAMkD,EAAE5E,OAAO0E,UAKlC,SACL,yBAAQC,SAAU,SAAAC,GAAC,OAAI9C,EAAQ8C,EAAE5E,OAAO0E,QAAQA,MAAO7C,EAAvD,UACI,wBAAQ6C,MAAM,GAAd,4HACC/C,GAASmD,OAAOC,QAAQpD,GAAOwB,KAAI,mCAAES,EAAF,KAAIoB,EAAJ,YAChC,yBAAgBN,MAAOd,EAAvB,UAA2BA,EAA3B,KAAgCoB,EAAhC,MAAapB,YAIpBW,GAAU,0BAASU,MAAO,CAACC,QAAQ,OAAQ,OAAS,aAA1C,UACP,cAAC,EAAD,CAAMpE,MAAO,yDAAb,SAA2B7B,EAAesF,EAAOtE,YACjD,cAAC,EAAD,CAAMa,MAAO,iCAAb,SAAuB7B,EAAesF,EAAOjE,aAC7C,cAAC,EAAD,CAAMQ,MAAO,iCAAb,SAAuB7B,EAAesF,EAAOhE,YAC7C,eAAC,EAAD,CAAMO,MAAO,0DAAb,WAA6ByD,EAAO1E,YAAc,GAAK,IAAIT,QAAQ,GAAnE,iBAGF2C,GAAc,aACfA,GAAc,qBAAKoD,IAAKhD,EAAiB8C,MAAO,CAACG,OAAO,WACzD,6BACKrD,GAAcA,EAAW4B,QAAO,SAAAC,GAAC,OAAK/B,GAAQ+B,EAAE/B,OAASA,KAAMsB,KAAI,SAAAS,GAAC,OAAI,cAAC,EAAD,CAAyBtE,SAAUsE,GAAhBA,EAAE7D,aGjE3FsF,MA5Cf,WACI,MAA0B9D,mBAAS,MAAnC,mBAAO1C,EAAP,KAAcyG,EAAd,KA+BF,OA9BElD,qBAAU,WACN,IACM5E,EADS,IAAI7B,gBAAgBP,OAAOC,SAASkK,QAC/BC,IAAI,QAExB,UAAGhI,QAAH,IAAGA,OAAH,EAAGA,EAAMtB,OASL,OARiB,uCAAG,sBAAAJ,EAAA,+EAENyB,EAAwBC,GAFlB,OAGZpC,OAAOC,SAASyE,KAAO1E,OAAOC,SAASyE,KAAK2F,QAAQrK,OAAOC,SAASkK,OAAQ,IAHhE,+CAKZnK,OAAOC,SAASyE,KAAO7E,IALX,wDAAH,oDAQVyK,IAEY,uCAAG,4BAAA5J,EAAA,+EAEMD,IAFN,OAERgD,EAFQ,OAGdyG,EAASzG,GAHK,gDAKdpB,QAAQC,IAAR,MALc,yDAAH,qDAUnBiI,KAGL,IAGH,sBAAKvH,UAAU,MAAf,UACOS,GAAS,yBAAQT,UAAU,SAAlB,UACN,cAAC,EAAD,IACA,wBAAQwH,QAAS,kBRuCxB,WAAP,+BQvCqCC,GAAmB7I,MAAK,kBAAM5B,OAAOC,SAASyK,aAArE,gDAEFjH,GAAS,wBAAQ+G,QAAS,kBAAMxK,OAAOC,SAASyE,KAAO7E,KAA9C,4CACZ4D,GAAS,cAAC,EAAD,CAAYA,MAAOA,QC/CrCkH,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAAC,EAAD,MAEFC,SAASC,eAAe,U,mBCP1BxL,EAAOC,QAAU,CAAC,IAAM,oBAAoB,KAAO,qBAAqB,KAAO,uB,mBCA/ED,EAAOC,QAAU,CAAC,KAAO,qBAAqB,UAAY,0BAA0B,YAAc,+B","file":"static/js/main.b031031b.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"form\":\"styles_form__3wXzo\"};","const client_id = 59766;\r\nconst client_secret = 'b7893c2f78225337f8ac6852e5c2fe313948c8f7';\r\nconst lsTokenKey = 'SportSeasonStravaTokenData';\r\nconst lsUserKey = 'SportSeasonStravaUserData';\r\n\r\nexport function getAuthLink() {\r\n    const data = {\r\n        client_id,\r\n        redirect_uri: window.location.origin,\r\n        response_type: 'code',\r\n        approval_prompt : 'auto',\r\n        scope: 'activity:read',\r\n        //state: ''\r\n    };\r\n\r\n    const searchParams = new URLSearchParams(data);\r\n\r\n    return `https://www.strava.com/oauth/authorize?${searchParams.toString()}`;\r\n}\r\n\r\nexport async function getAuthTokenAsync() {\r\n    const lsTokenDataStr = localStorage.getItem(lsTokenKey);\r\n\r\n    if (lsTokenDataStr && lsTokenDataStr.length) {\r\n        const tData = JSON.parse(lsTokenDataStr);\r\n        if (tData.expires_at && tData.expires_at * 1000 > Date.now()) {\r\n            return tData.access_token;\r\n        }\r\n\r\n        if (tData.refresh_token) {\r\n            try {\r\n                const result = await fetch(\"https://www.strava.com/api/v3/oauth/token\", {\r\n                    body: new URLSearchParams({\r\n                        client_id,\r\n                        client_secret,\r\n                        refresh_token: tData.refresh_token,\r\n                        grant_type: 'refresh_token'\r\n                    }).toString(),\r\n                    headers: {\r\n                        \"Content-Type\": \"application/x-www-form-urlencoded\"\r\n                    },\r\n                    method: \"POST\"\r\n                }).then(res => res.json());\r\n                localStorage.setItem(lsTokenKey, JSON.stringify(result));\r\n\r\n                return result.access_token;\r\n\r\n            } catch (error) {\r\n                throw new Error(error);\r\n            }\r\n        }\r\n\r\n        throw new Error('no token');\r\n    } else {\r\n        throw new Error('no stored token data');\r\n    }\r\n}\r\n\r\nexport async function setAuthTokenByCodeAsync(code) {\r\n    try {\r\n        const result = await fetch(\"https://www.strava.com/api/v3/oauth/token\", {\r\n            body: new URLSearchParams({\r\n                client_id,\r\n                client_secret,\r\n                code,\r\n                grant_type: 'authorization_code'\r\n            }).toString(),\r\n            headers: {\r\n                \"Content-Type\": \"application/x-www-form-urlencoded\"\r\n            },\r\n            method: \"POST\"\r\n        }).then(res => res.json());\r\n\r\n        console.log({result})\r\n        const { athlete, ...tokenData } = result;\r\n\r\n        localStorage.setItem(lsUserKey, JSON.stringify(athlete));\r\n        localStorage.setItem(lsTokenKey, JSON.stringify(tokenData));\r\n\r\n        return result.access_token;\r\n\r\n    } catch (error) {\r\n        throw new Error(error);\r\n    }\r\n\r\n}\r\n\r\nexport async function unAuthorizeAsync(){\r\n    const access_token = '';\r\n    try {\r\n        await fetch(\r\n            `https://www.strava.com/oauth/deauthorize?${new URLSearchParams({ access_token }).toString()}`,\r\n            { method: \"POST\" }\r\n            ).then(res => res.json());\r\n        localStorage.removeItem(lsTokenKey);\r\n        localStorage.removeItem(lsUserKey);\r\n\r\n        return Promise.resolve({ success: true });\r\n    } catch (error) {\r\n        throw new Error(error);\r\n    }\r\n}\r\n\r\nexport function getUser() {\r\n    return JSON.parse(localStorage.getItem(lsUserKey));\r\n}\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { getUser } from '../../services/authService';\r\nimport styles from './styles.module.css';\r\n\r\nconst Profile = (props) => {\r\n    const user = getUser();\r\n    return <div className={styles.prof}>\r\n        <img src={user.profile_medium} className={styles.ava} />\r\n        <div className={styles.name}>\r\n            {user.lastname}\r\n            <strong>{user.firstname}</strong>\r\n        </div>\r\n    </div>;\r\n};\r\n\r\nProfile.propTypes = {};\r\n\r\nexport default Profile;\r\n","export async function getActivitiesAsync(token, t1, t2) {\r\n    return await fetch(`https://www.strava.com/api/v3/athlete/activities?before=${t2}&after=${t1}&page=1&per_page=100`, {\r\n        headers: {\r\n            Authorization: `Bearer ${token}`\r\n        }\r\n    }).then(res => res.json());\r\n\r\n}\r\n","export function formatDistance(d) {\r\n    if (!(d > 0)) { return '-'; }\r\n    return d > 1000 ? `${parseFloat(d / 1000).toFixed(2)}\\u202fкм` : `${parseFloat(d).toFixed()}\\u2009м`;\r\n}\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { act } from '@testing-library/react';\r\nimport { formatDistance } from '../../../../helpers/formatHelper';\r\n\r\nconst ActivityItem = ({ activity }) => {\r\n\r\n    const t1 = Date.parse(activity.start_date_local) - (activity.utc_offset * 1000)\r\n    const d1 = new Date(t1);\r\n    const d2 = new Date(t1 + (activity.elapsed_time * 1000));\r\n    const at = new Date((activity.moving_time - activity.utc_offset ) * 1000);\r\n\r\n    return <div>\r\n        <a href={`https://www.strava.com/activities/${activity.id}`} target={'_blank'}>{activity.name}</a>\r\n        <strong>{formatDistance(activity.distance)}</strong>\r\n        {d1.toLocaleString().substr(0,17)}\r\n        -\r\n        {d1.toLocaleDateString() !== d2.toLocaleDateString() && d2.toLocaleDateString()}\r\n        {d2.toLocaleTimeString().substr(0,5)}\r\n        (движ: {at.toLocaleTimeString().substr(0,5)})\r\n        <br/>\r\n        {activity.elev_high}/{activity.elev_low} {activity.average_heartrate}/{activity.max_heartrate} {activity.average_speed}/{activity.speed}\r\n    </div>;\r\n};\r\n\r\nActivityItem.propTypes = {\r\n    activity: PropTypes.shape({\r\n/*\r\n* achievement_count: 0\r\nathlete: {id: 12602406, resource_state: 1}\r\nathlete_count: 2\r\naverage_cadence: 46.2\r\naverage_heartrate: 109.6\r\naverage_speed: 1.15\r\ncomment_count: 0\r\ncommute: false\r\ndisplay_hide_heartrate_option: true\r\ndistance: 15153.2\r\nelapsed_time: 19210\r\nelev_high: 268.6\r\nelev_low: 171.1\r\nend_latlng: (2) [53.22, 44.91]\r\nexternal_id: \"b1046a83-5025-48bc-81a6-ff2ed5ebf35b-activity.fit\"\r\nflagged: false\r\nfrom_accepted_tag: false\r\ngear_id: \"g6417986\"\r\nhas_heartrate: true\r\nhas_kudoed: false\r\nheartrate_opt_out: false\r\nid: 5872168321\r\nkudos_count: 7\r\nlocation_city: null\r\nlocation_country: \"Russia\"\r\nlocation_state: null\r\nmanual: false\r\nmap: {id: \"a5872168321\", summary_polyline: \"gfzcIyicqGSNJQE_AHAMGDI_@wAEeBN}@\\\\u@KyAjAO@]LM?eCJ…BLu@Km@EoIOq@GeBi@YM}@KMmAV]ZMKGe@a@i@EeAJQlANEh@\", resource_state: 2}\r\nmax_heartrate: 148\r\nmax_speed: 4\r\nmoving_time: 13179\r\nname: \"Полуденная ходьба\"\r\nphoto_count: 0\r\npr_count: 0\r\nprivate: false\r\nresource_state: 2\r\nstart_date: \"2021-08-29T08:14:02Z\"\r\nstart_date_local: \"2021-08-29T11:14:02Z\"\r\nstart_latitude: 53.22\r\nstart_latlng: (2) [53.22, 44.91]\r\nstart_longitude: 44.91\r\ntimezone: \"(GMT+03:00) Europe/Moscow\"\r\ntotal_elevation_gain: 189.2\r\ntotal_photo_count: 16\r\ntrainer: false\r\ntype: \"Walk\"\r\nupload_id: 6243513574\r\nupload_id_str: \"6243513574\"\r\nutc_offset: 10800\r\nvisibility: \"everyone\"\r\n\r\n* */\r\n    }).isRequired,\r\n};\r\n\r\nexport default ActivityItem;\r\n","import React, { useEffect, useState, useRef } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport * as L from 'leaflet';\r\nimport polyline from '@mapbox/polyline';\r\nimport { getActivitiesAsync } from '../../services/activitiesService';\r\nimport ActivityItem from './components/ActivityItem';\r\nimport { formatDistance } from '../../helpers/formatHelper';\r\nimport { clearMap } from '../../helpers/mapHelper';\r\nimport Card from './components/Card';\r\nimport styles from './styles.module.css'\r\nconst now = new Date();\r\nconst defaultD1 = new Date(now.getFullYear(), 0, 1, 4, 0, 0, 1);\r\nconst defaultD2 = new Date(now.getFullYear(), 11, 31, 23, 59, 59, 999);\r\nlet debounceTimer;\r\n\r\nconst Activities = ({ token }) => {\r\n    const [d1, setD1] = useState(localStorage.getItem('stravastatD1') || defaultD1.toISOString().substr(0,10));\r\n    const [d2, setD2] = useState(localStorage.getItem('stravastatD2') || defaultD2.toISOString().substr(0,10));\r\n    const [types, setTypes] = useState([]);\r\n    const [type, setType] = useState(localStorage.getItem('stravastatType'));\r\n    const [activities, setActivities] = useState(null);\r\n    const mapRef = useRef();\r\n    const mapContainerRef = useRef();\r\n\r\n    useEffect(() => {\r\n\r\n        clearTimeout(debounceTimer);\r\n        debounceTimer = setTimeout(() => {\r\n            setActivities(null);\r\n            localStorage.setItem('stravastatD1', d1);\r\n            localStorage.setItem('stravastatD2', d2);\r\n\r\n            getActivitiesAsync(token, Math.floor(Date.parse(d1) / 1000), Math.floor(Date.parse(d2) / 1000))\r\n                .then(res => {\r\n                    setActivities(res);\r\n                    setTypes(res.reduce((acc, {type}) => ({...acc, [type]: (acc[type] || 0) + 1}), {}));\r\n                    console.log(res)\r\n                })\r\n\r\n        }, 600);\r\n\r\n    }, [d1, d2, token]);\r\n\r\n    useEffect(() => {\r\n        localStorage.setItem('stravastatType', type);\r\n    }, [type])\r\n\r\n\r\n    useEffect(()=> {\r\n        if (!mapContainerRef?.current) {\r\n            return;\r\n        }\r\n\r\n        if (!mapRef?.current) {\r\n            mapRef.current = L.map(\r\n                mapContainerRef.current,\r\n                { fullscreenControl: true }\r\n            ).setView([53.2006600, 45.0046400], 12);\r\n\r\n            L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n                attribution: 'Map data © <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors',\r\n                maxZoom: 20,\r\n                id: 'osm'\r\n            }).addTo(mapRef.current);\r\n        }\r\n\r\n\r\n\r\n        const boundCoordinates = [];\r\n\r\n        clearMap(mapRef.current);\r\n        activities.filter(x => !type || x.type === type).forEach(({ map: {summary_polyline} }) => {\r\n            if (summary_polyline?.length) {\r\n                const coords = polyline.decode(summary_polyline);\r\n                L.polyline(coords).setStyle({\r\n                    color: 'rgba(255, 0, 0,0.5)'\r\n                }).addTo(mapRef.current)\r\n                boundCoordinates.push(coords)\r\n            }\r\n        })\r\n\r\n        const bounds = L.latLngBounds(boundCoordinates);\r\n        boundCoordinates?.length && mapRef.current.fitBounds(bounds);// works!\r\n\r\n    }, [mapContainerRef.current, activities, type]);\r\n\r\n\r\n    const aggreg = activities && activities.filter(x => !type || x.type === type).reduce((acc, val) => {\r\n        return {\r\n            distance: acc.distance + val.distance,\r\n            elev_high: acc.elev_high + val.elev_high || 0,\r\n            elev_low: acc.elev_low + val.elev_low || 0,\r\n            elapsed_time: acc.elapsed_time + val.elapsed_time,\r\n            moving_time: acc.moving_time + val.moving_time\r\n        };\r\n    }, { distance: 0, elev_high: 0, elev_low: 0, elapsed_time: 0, moving_time: 0 })\r\n\r\n    let handleChangeD1 = (e) => setD1(e.target.value);\r\n    let handleChangeD2 = (e) => setD2(e.target.value);\r\n\r\n    return <div>\r\n        <div className={styles.form}><input type=\"date\" value={d1} onChange={handleChangeD1}/>-\r\n        <input type=\"date\" value={d2} max={defaultD2.toISOString().substr(0,10)} onChange={handleChangeD2}/>\r\n            {' \\u00a0 '}\r\n        <select onChange={e => setType(e.target.value)} value={type}>\r\n            <option value=\"\">Все виды активностей</option>\r\n            {types && Object.entries(types).map(([x,v]) => (\r\n                <option key={x} value={x}>{x} ({v})</option>\r\n            ))}\r\n        </select>\r\n        </div>\r\n        {aggreg && <section style={{display:'flex', 'margin':'10px auto'}}>\r\n            <Card title={'Дистанция'}>{formatDistance(aggreg.distance)}</Card>\r\n            <Card title={'Набор'}>{formatDistance(aggreg.elev_high)}</Card>\r\n            <Card title={'Сброс'}>{formatDistance(aggreg.elev_low)}</Card>\r\n            <Card title={'В движении'}>{(aggreg.moving_time / 60 / 60).toFixed(2)} ч</Card>\r\n        </section>\r\n        }\r\n        {!activities && 'loading...'}\r\n        {activities && <div ref={mapContainerRef} style={{height:'300px'}}/>}\r\n        <ul>\r\n            {activities && activities.filter(x => !type || x.type === type).map(x => <ActivityItem key={x.id} activity={x} /> )}\r\n        </ul>\r\n    </div>;\r\n};\r\n\r\nActivities.propTypes = {\r\n    token: PropTypes.string,\r\n};\r\n\r\nexport default Activities;\r\n","import React from 'react';\r\nimport styles from './styles.module.css';\r\nimport PropTypes from 'prop-types';\r\n\r\nconst Card = ({title, children}) => {\r\n    return <div className={styles.card}>\r\n        <div className={styles.cardTitle}>{title}</div>\r\n        <div className={styles.cardContent}>{children}</div>\r\n    </div>;\r\n};\r\n\r\nCard.propTypes = {};\r\n\r\nexport default Card;\r\n","export function clearMap(map) {\r\n    map.eachLayer((layer) => {\r\n        const hasEmptyContrib = !(layer.getAttribution && layer.getAttribution());\r\n        const hasNoContrib = !layer.getAttribution;\r\n        if (hasEmptyContrib || hasNoContrib) {\r\n            map.removeLayer(layer);\r\n        }\r\n    })\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport './App.css';\r\nimport {\r\n    getAuthLink,\r\n    getAuthTokenAsync,\r\n    setAuthTokenByCodeAsync,\r\n    unAuthorizeAsync\r\n} from './services/authService';\r\nimport Profile from './components/Profile';\r\nimport Activities from './components/Activities';\r\n\r\n\r\nfunction App() {\r\n    const [token, setToken] = useState(null);\r\n    useEffect(() => {\r\n        const params = new URLSearchParams(window.location.search);\r\n        const code = params.get('code');\r\n\r\n        if(code?.length) {\r\n            const getUserData = async () => {\r\n                try {\r\n                    await setAuthTokenByCodeAsync(code);\r\n                    window.location.href = window.location.href.replace(window.location.search, '');\r\n                } catch (e) {\r\n                    window.location.href = getAuthLink();\r\n                }\r\n            }\r\n            return getUserData();\r\n        } else {\r\n            const getStoredData = async () => {\r\n                try {\r\n                    const token = await getAuthTokenAsync();\r\n                    setToken(token);\r\n                } catch (e) {\r\n                    console.log(e)\r\n                    //window.location.href = getAuthLink();\r\n                }\r\n            }\r\n\r\n            getStoredData();\r\n        }\r\n\r\n    }, []);\r\n\r\n  return (\r\n    <div className=\"App\">\r\n          {token && <header className=\"header\">\r\n              <Profile />\r\n              <button onClick={() => unAuthorizeAsync().then(() => window.location.reload())}>Выйти</button>\r\n          </header>}\r\n          {!token && <button onClick={() => window.location.href = getAuthLink()}>Войти</button>}\r\n        {token && <Activities token={token} /> }\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"ava\":\"styles_ava__3uCq3\",\"prof\":\"styles_prof__xcgdj\",\"name\":\"styles_name__LOOD9\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"card\":\"styles_card__2aJrc\",\"cardTitle\":\"styles_cardTitle__QB308\",\"cardContent\":\"styles_cardContent__77HFA\"};"],"sourceRoot":""}
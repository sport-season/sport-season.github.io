{"version":3,"sources":["components/Chart/styles.module.css","components/Activities/styles.module.css","components/Menu/styles.module.css","components/Profile/styles.module.css","components/Activities/components/Card/styles.module.css","components/Donate/styles.module.css","components/Thanks/styles.module.css","components/Activities/components/ActivityItem/styles.module.css","components/Modal/styles.module.css","components/Activities/components/Widget/style.module.css","components/Loader/styles.module.css","components/FullScreen/styles.module.css","libs/leaflet-fullscreen/Leaflet.fullscreen.js","services/authService.js","components/Profile/index.js","services/indexedDBService.js","services/activitiesService.js","helpers/formatHelper.js","components/Activities/components/ActivityItem/index.js","helpers/debounceHelper.js","contexts/userContext.js","components/Modal/index.js","components/Chart/index.js","components/Activities/components/Card/index.js","components/Activities/components/Widget/index.js","components/Loader/index.js","images/long-512_orange.png","helpers/gpxHelper.js","components/Activities/helpers.js","components/Activities/index.js","helpers/mapHelper.js","helpers/downloadHelper.js","components/FullScreen/index.js","components/Welcome/index.js","components/Donate/index.js","components/Menu/index.js","App.js","components/Thanks/index.js","index.js"],"names":["module","exports","factory","L","require","Control","Fullscreen","extend","options","position","title","onAdd","map","container","DomUtil","create","this","link","href","_map","on","_toggleTitle","DomEvent","_click","e","stopPropagation","preventDefault","toggleFullscreen","isFullscreen","Map","include","_isFullscreen","getContainer","pseudoFullscreen","_disablePseudoFullscreen","document","exitFullscreen","mozCancelFullScreen","webkitCancelFullScreen","msExitFullscreen","_enablePseudoFullscreen","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","Element","ALLOW_KEYBOARD_INPUT","msRequestFullscreen","addClass","_setFullscreen","fire","removeClass","fullscreen","invalidateSize","_onFullscreenChange","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","mergeOptions","fullscreenControl","addInitHook","fullscreenchange","addControl","onFullscreenChange","bind","whenReady","off","control","client_id","client_secret","lsTokenKey","lsUserKey","getAuthLink","data","redirect_uri","window","location","origin","response_type","approval_prompt","scope","searchParams","URLSearchParams","toString","getAuthTokenAsync","a","lsTokenDataStr","localStorage","getItem","length","tData","JSON","parse","expires_at","Date","now","access_token","refresh_token","fetch","body","grant_type","headers","method","then","res","json","result","setItem","stringify","Error","setAuthTokenByCodeAsync","code","console","log","athlete","tokenData","unAuthorizeAsync","clear","Promise","resolve","success","getUser","Profile","props","user","className","styles","prof","src","profile_medium","ava","name","lastname","firstname","instance","version","isReady","openDB","upgrade","db","createObjectStore","keyPath","createIndex","oneOrSeveralObjs","tx","transaction","objectStore","Array","isArray","all","obj","store","add","done","getAll","getActivitiesAsync","token","t1","t2","page","limit","Authorization","formatDistance","d","destructure","parts","parseFloat","toFixed","join","ActivityItem","activity","start_date_local","utc_offset","d1","d2","elapsed_time","at","moving_time","id","rel","target","item","row","distance","toLocaleString","substr","toLocaleDateString","toLocaleTimeString","total_elevation_gain","average_speed","average_heartrate","max_heartrate","debounceTimeout","UserContext","createContext","debounceAsync","duration","clearTimeout","setTimeout","Modal","children","onClose","useEffect","style","overflow","overlay","onClick","modal","showModal","createElement","appendChild","ReactDOM","removeChild","getMonthName","date","getMonth","toUpperCase","getFullYear","Chart","activities","useState","size","setSize","minD","start_date","maxD","shif","getDay","agg","mo","cur","getTime","w","actual","filter","x","toISOString","push","m","cou","acts","dist","reduce","s","filledActivities","max","prev","curr","handleZoom","coeff","chartSection","chartSectionHeader","xmlns","width","height","fill","viewBox","fillRule","chart","fontSize","daysName","main","monthsBar","month","empty_point","i","point","backgroundColor","showDay","getDate","Card","unit","card","cardTitle","cardContent","Widget","count","dU","h","hU","widgetContainer","Math","round","Loader","loader","getLatLonAsGpx","latlon","str","lat","lon","url","trim","getPopupContentForActivity","summary_polyline","div","innerText","footer","marginTop","btn","marginRight","onclick","download","click","downloadLatLonAsGpx","polyline","decode","navigator","canShare","blob","File","type","getGPXFileAsync","file","shareData","files","share","catch","error","_target","defaultD1","defaultD2","minDate","Activities","setD1","setD2","types","setTypes","loading","setIsLoading","setType","setActivities","mapRef","useRef","mapContainerRef","useContext","localDB","getAllActivity","handleUpdate","acc","current","setView","attribution","maxZoom","addTo","Watermark","img","logo","opacity","onRemove","watermark","opts","boundCoordinates","eachLayer","layer","hasEmptyContrib","getAttribution","hasNoContrib","removeLayer","filtredActivities","dX","dS","dE","forEach","coords","setStyle","color","bindPopup","bounds","fitBounds","aggreg","val","handleChangeD1","value","handleChangeD2","useCallback","isInitial","lastActivityDate","lastBatch","floor","time","addActivities","timeEnd","reload","align","floatButton","disabled","form","dates","min","onChange","Object","entries","v","ref","filename","dataObjToWrite","Blob","URL","createObjectURL","dataset","downloadurl","evt","MouseEvent","view","bubbles","cancelable","dispatchEvent","remove","saveJSONAsFile","arrOfArr","saveArrayAsCSV","FullScreen","fullScreen","Welcome","Donate","menu","header","content","frameBorder","scrolling","Menu","handleLogout","confirm","borderColor","App","setToken","setLoading","dbLoading","setDbLoading","err","setErr","search","get","history","pushState","message","getUserData","getStoredData","init","finally","Provider","Thanks","hash","render","StrictMode","getElementById","onload"],"mappings":"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","file":"static/js/main.c5729371.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"chartSection\":\"styles_chartSection__3D3w5\",\"chartSectionHeader\":\"styles_chartSectionHeader__1h_pL\",\"chart\":\"styles_chart__1fr1I\",\"daysName\":\"styles_daysName__JkWod\",\"main\":\"styles_main__1F0ux\",\"container\":\"styles_container__30do-\",\"empty_point\":\"styles_empty_point__1_hCh\",\"point\":\"styles_point__3-Aw6\",\"monthsBar\":\"styles_monthsBar__oD7KP\",\"month\":\"styles_month__2TdZt\",\"m1\":\"styles_m1__1U8OE\",\"m2\":\"styles_m2__QQF5g\",\"m3\":\"styles_m3__2W_fr\",\"m4\":\"styles_m4__26BIj\",\"m5\":\"styles_m5__6bCBt\",\"m6\":\"styles_m6__21a6a\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"form\":\"styles_form__3tUJe\",\"dates\":\"styles_dates__1_z2B\",\"floatButton\":\"styles_floatButton__1u2k3\",\"rotation\":\"styles_rotation__3YMpG\",\"loader\":\"styles_loader__OZ8B8\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"header\":\"styles_header__1O5zU\",\"menu\":\"styles_menu__12zhE\",\"content\":\"styles_content__3jGXF\",\"footer\":\"styles_footer__2NuR6\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"ava\":\"styles_ava__3YR7H\",\"prof\":\"styles_prof__3vmCY\",\"name\":\"styles_name__hiv1W\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"card\":\"styles_card__2PnlW\",\"cardTitle\":\"styles_cardTitle__2RYCP\",\"cardContent\":\"styles_cardContent__2P7Js\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"header\":\"styles_header__1DZjb\",\"menu\":\"styles_menu__fW9GW\",\"content\":\"styles_content__3bbEM\",\"footer\":\"styles_footer__suOHF\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"header\":\"styles_header__11ejz\",\"menu\":\"styles_menu__1fxnY\",\"content\":\"styles_content__Lv9gm\",\"footer\":\"styles_footer__3UWIN\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"item\":\"styles_item__2VYFB\",\"row\":\"styles_row__c1fPJ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"overlay\":\"styles_overlay__2XvFz\",\"modal\":\"styles_modal__2KEOL\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"widgetContainer\":\"style_widgetContainer__1OWol\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"loader\":\"styles_loader__L5roB\",\"sk-chase\":\"styles_sk-chase__3sk3Y\",\"sk-chase-dot\":\"styles_sk-chase-dot__2BJc1\",\"sk-chase-dot-before\":\"styles_sk-chase-dot-before__2wf3h\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"fullScreen\":\"styles_fullScreen__22uDo\"};","(function (factory) {\r\n    if (typeof module !== 'undefined') {\r\n        // Node/CommonJS\r\n        module.exports = factory(require('leaflet'));\r\n    } else {\r\n        // Browser globals\r\n        if (typeof window.L === 'undefined') {\r\n            throw new Error('Leaflet must be loaded first');\r\n        }\r\n        factory(window.L);\r\n    }\r\n}(function (L) {\r\n    L.Control.Fullscreen = L.Control.extend({\r\n        options: {\r\n            position: 'topleft',\r\n            title: {\r\n                'false': 'View Fullscreen',\r\n                'true': 'Exit Fullscreen'\r\n            }\r\n        },\r\n\r\n        onAdd: function (map) {\r\n            var container = L.DomUtil.create('div', 'leaflet-control-fullscreen leaflet-bar leaflet-control');\r\n\r\n            this.link = L.DomUtil.create('a', 'leaflet-control-fullscreen-button leaflet-bar-part', container);\r\n            this.link.href = '#';\r\n\r\n            this._map = map;\r\n            this._map.on('fullscreenchange', this._toggleTitle, this);\r\n            this._toggleTitle();\r\n\r\n            L.DomEvent.on(this.link, 'click', this._click, this);\r\n\r\n            return container;\r\n        },\r\n\r\n        _click: function (e) {\r\n            L.DomEvent.stopPropagation(e);\r\n            L.DomEvent.preventDefault(e);\r\n            this._map.toggleFullscreen(this.options);\r\n        },\r\n\r\n        _toggleTitle: function() {\r\n            this.link.title = this.options.title[this._map.isFullscreen()];\r\n        }\r\n    });\r\n\r\n    L.Map.include({\r\n        isFullscreen: function () {\r\n            return this._isFullscreen || false;\r\n        },\r\n\r\n        toggleFullscreen: function (options) {\r\n            var container = this.getContainer();\r\n            if (this.isFullscreen()) {\r\n                if (options && options.pseudoFullscreen) {\r\n                    this._disablePseudoFullscreen(container);\r\n                } else if (document.exitFullscreen) {\r\n                    document.exitFullscreen();\r\n                } else if (document.mozCancelFullScreen) {\r\n                    document.mozCancelFullScreen();\r\n                } else if (document.webkitCancelFullScreen) {\r\n                    document.webkitCancelFullScreen();\r\n                } else if (document.msExitFullscreen) {\r\n                    document.msExitFullscreen();\r\n                } else {\r\n                    this._disablePseudoFullscreen(container);\r\n                }\r\n            } else {\r\n                if (options && options.pseudoFullscreen) {\r\n                    this._enablePseudoFullscreen(container);\r\n                } else if (container.requestFullscreen) {\r\n                    container.requestFullscreen();\r\n                } else if (container.mozRequestFullScreen) {\r\n                    container.mozRequestFullScreen();\r\n                } else if (container.webkitRequestFullscreen) {\r\n                    container.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);\r\n                } else if (container.msRequestFullscreen) {\r\n                    container.msRequestFullscreen();\r\n                } else {\r\n                    this._enablePseudoFullscreen(container);\r\n                }\r\n            }\r\n\r\n        },\r\n\r\n        _enablePseudoFullscreen: function (container) {\r\n            L.DomUtil.addClass(container, 'leaflet-pseudo-fullscreen');\r\n            this._setFullscreen(true);\r\n            this.fire('fullscreenchange');\r\n        },\r\n\r\n        _disablePseudoFullscreen: function (container) {\r\n            L.DomUtil.removeClass(container, 'leaflet-pseudo-fullscreen');\r\n            this._setFullscreen(false);\r\n            this.fire('fullscreenchange');\r\n        },\r\n\r\n        _setFullscreen: function(fullscreen) {\r\n            this._isFullscreen = fullscreen;\r\n            var container = this.getContainer();\r\n            if (fullscreen) {\r\n                L.DomUtil.addClass(container, 'leaflet-fullscreen-on');\r\n            } else {\r\n                L.DomUtil.removeClass(container, 'leaflet-fullscreen-on');\r\n            }\r\n            this.invalidateSize();\r\n        },\r\n\r\n        _onFullscreenChange: function (e) {\r\n            var fullscreenElement =\r\n                document.fullscreenElement ||\r\n                document.mozFullScreenElement ||\r\n                document.webkitFullscreenElement ||\r\n                document.msFullscreenElement;\r\n\r\n            if (fullscreenElement === this.getContainer() && !this._isFullscreen) {\r\n                this._setFullscreen(true);\r\n                this.fire('fullscreenchange');\r\n            } else if (fullscreenElement !== this.getContainer() && this._isFullscreen) {\r\n                this._setFullscreen(false);\r\n                this.fire('fullscreenchange');\r\n            }\r\n        }\r\n    });\r\n\r\n    L.Map.mergeOptions({\r\n        fullscreenControl: false\r\n    });\r\n\r\n    L.Map.addInitHook(function () {\r\n        if (this.options.fullscreenControl) {\r\n            this.fullscreenControl = new L.Control.Fullscreen(this.options.fullscreenControl);\r\n            this.addControl(this.fullscreenControl);\r\n        }\r\n\r\n        var fullscreenchange;\r\n\r\n        if ('onfullscreenchange' in document) {\r\n            fullscreenchange = 'fullscreenchange';\r\n        } else if ('onmozfullscreenchange' in document) {\r\n            fullscreenchange = 'mozfullscreenchange';\r\n        } else if ('onwebkitfullscreenchange' in document) {\r\n            fullscreenchange = 'webkitfullscreenchange';\r\n        } else if ('onmsfullscreenchange' in document) {\r\n            fullscreenchange = 'MSFullscreenChange';\r\n        }\r\n\r\n        if (fullscreenchange) {\r\n            var onFullscreenChange = L.bind(this._onFullscreenChange, this);\r\n\r\n            this.whenReady(function () {\r\n                L.DomEvent.on(document, fullscreenchange, onFullscreenChange);\r\n            });\r\n\r\n            this.on('unload', function () {\r\n                L.DomEvent.off(document, fullscreenchange, onFullscreenChange);\r\n            });\r\n        }\r\n    });\r\n\r\n    L.control.fullscreen = function (options) {\r\n        return new L.Control.Fullscreen(options);\r\n    };\r\n}));\r\n","const client_id = 59766;\r\nconst client_secret = 'b7893c2f78225337f8ac6852e5c2fe313948c8f7';\r\nconst lsTokenKey = 'SportSeasonStravaTokenData';\r\nconst lsUserKey = 'SportSeasonStravaUserData';\r\n\r\nexport function getAuthLink() {\r\n    const data = {\r\n        client_id,\r\n        redirect_uri: window.location.origin,\r\n        response_type: 'code',\r\n        approval_prompt : 'auto',\r\n        scope: 'activity:read',\r\n        //state: ''\r\n    };\r\n\r\n    const searchParams = new URLSearchParams(data);\r\n\r\n    return `https://www.strava.com/oauth/authorize?${searchParams.toString()}`;\r\n}\r\n\r\nexport async function getAuthTokenAsync() {\r\n    const lsTokenDataStr = localStorage.getItem(lsTokenKey);\r\n\r\n    if (lsTokenDataStr && lsTokenDataStr.length) {\r\n        const tData = JSON.parse(lsTokenDataStr);\r\n        if (tData.expires_at && tData.expires_at * 1000 > Date.now()) {\r\n            return tData.access_token;\r\n        }\r\n\r\n        if (tData.refresh_token) {\r\n            try {\r\n                const result = await fetch(\"https://www.strava.com/api/v3/oauth/token\", {\r\n                    body: new URLSearchParams({\r\n                        client_id,\r\n                        client_secret,\r\n                        refresh_token: tData.refresh_token,\r\n                        grant_type: 'refresh_token'\r\n                    }).toString(),\r\n                    headers: {\r\n                        \"Content-Type\": \"application/x-www-form-urlencoded\"\r\n                    },\r\n                    method: \"POST\"\r\n                }).then(res => res.json());\r\n                localStorage.setItem(lsTokenKey, JSON.stringify(result));\r\n\r\n                return result.access_token;\r\n\r\n            } catch (error) {\r\n                throw new Error(error);\r\n            }\r\n        }\r\n\r\n        throw new Error('no token');\r\n    } else {\r\n        throw new Error('no stored token data');\r\n    }\r\n}\r\n\r\nexport async function setAuthTokenByCodeAsync(code) {\r\n    try {\r\n        const result = await fetch(\"https://www.strava.com/api/v3/oauth/token\", {\r\n            body: new URLSearchParams({\r\n                client_id,\r\n                client_secret,\r\n                code,\r\n                grant_type: 'authorization_code'\r\n            }).toString(),\r\n            headers: {\r\n                \"Content-Type\": \"application/x-www-form-urlencoded\"\r\n            },\r\n            method: \"POST\"\r\n        }).then(res => res.json());\r\n\r\n        console.log({result})\r\n        const { athlete, ...tokenData } = result;\r\n\r\n        localStorage.setItem(lsUserKey, JSON.stringify(athlete));\r\n        localStorage.setItem(lsTokenKey, JSON.stringify(tokenData));\r\n\r\n        return result.access_token;\r\n\r\n    } catch (error) {\r\n        throw new Error(error);\r\n    }\r\n\r\n}\r\n\r\nexport async function unAuthorizeAsync(){\r\n    const access_token = '';\r\n    try {\r\n        await fetch(\r\n            `https://www.strava.com/oauth/deauthorize?${new URLSearchParams({ access_token }).toString()}`,\r\n            { method: \"POST\" }\r\n            ).then(res => res.json());\r\n        localStorage.clear();\r\n\r\n        return Promise.resolve({ success: true });\r\n    } catch (error) {\r\n        throw new Error(error);\r\n    }\r\n}\r\n\r\nexport function getUser() {\r\n    return JSON.parse(localStorage.getItem(lsUserKey));\r\n}\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { getUser } from '../../services/authService';\r\nimport styles from './styles.module.css';\r\n\r\nconst Profile = (props) => {\r\n    const user = getUser();\r\n    return <div className={styles.prof}>\r\n        <img src={user.profile_medium} className={styles.ava} />\r\n        <div className={styles.name}>\r\n            {user.lastname}\r\n            <strong>{user.firstname}</strong>\r\n        </div>\r\n    </div>;\r\n};\r\n\r\nProfile.propTypes = {};\r\n\r\nexport default Profile;\r\n","import { openDB } from 'idb/with-async-ittr.js';\r\n\r\nclass LocalDb {\r\n    constructor(name, version) {\r\n        this.isReady = false;\r\n    }\r\n\r\n    async init(name, version) {\r\n        this.db = await openDB(name, version, {\r\n            upgrade(db) {\r\n                db.createObjectStore('activities', { keyPath: 'id' })\r\n                    .createIndex('start_date', 'start_date');\r\n            },\r\n        });\r\n        this.isReady = true;\r\n    }\r\n\r\n    addActivities(oneOrSeveralObjs) {\r\n        let tx = this.db.transaction('activities', 'readwrite');\r\n        let store = tx.objectStore('activities');\r\n        if (Array.isArray(oneOrSeveralObjs)) {\r\n            return Promise.all([\r\n                ...oneOrSeveralObjs.map(obj => tx.store.add(obj)),\r\n                tx.done\r\n            ]);\r\n        }\r\n        return tx.add('activities', oneOrSeveralObjs)\r\n    }\r\n\r\n    getAllActivity() {\r\n        let tx = this.db.transaction('activities');\r\n        let store = tx.objectStore('activities');\r\n        return store.getAll();\r\n    }\r\n    clear() {\r\n        let tx = this.db.transaction('activities', 'readwrite');\r\n        let store = tx.objectStore('activities');\r\n        return store.clear();\r\n    }\r\n\r\n}\r\n\r\nconst instance = new LocalDb();\r\nexport default instance;\r\n","export async function getActivitiesAsync(token, t1, t2, page = 1, limit=100) {\r\n    return await fetch(`https://www.strava.com/api/v3/athlete/activities?before=${t2}&after=${t1}&page=${page}&per_page=${limit}`, {\r\n        headers: {\r\n            Authorization: `Bearer ${token}`\r\n        }\r\n    }).then(res => res.json());\r\n}\r\n","export function formatDistance(d, destructure = false) {\r\n    if (!d) { return '-'; }\r\n    const parts = d > 1000\r\n        ? [parseFloat(d / 1000).toFixed(2), 'км']\r\n        : [parseFloat(d).toFixed(2), 'м'];\r\n\r\n    return destructure ? parts : parts.join('\\u202f');\r\n}\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { formatDistance } from '../../../../helpers/formatHelper';\r\nimport styles from './styles.module.css';\r\n\r\nconst ActivityItem = ({ activity }) => {\r\n\r\n    const t1 = Date.parse(activity.start_date_local) - (activity.utc_offset * 1000)\r\n    const d1 = new Date(t1);\r\n    const d2 = new Date(t1 + (activity.elapsed_time * 1000));\r\n    const at = new Date((activity.moving_time - activity.utc_offset ) * 1000);\r\n\r\n    return <a href={`https://www.strava.com/activities/${activity.id}`} rel=\"noreferrer\" target={'_blank'} className={styles.item}>\r\n        <div className={styles.row}>\r\n            <strong>{activity.name}</strong>\r\n            <strong>{formatDistance(activity.distance)}</strong>\r\n        </div>\r\n\r\n        <small>{d1.toLocaleString().substr(0,17)}\r\n        -\r\n        {d1.toLocaleDateString() !== d2.toLocaleDateString() && d2.toLocaleDateString()}\r\n        {d2.toLocaleTimeString().substr(0,5)},\r\n            в движении: {at.toLocaleTimeString().substr(0,5)}</small>\r\n        <br/>\r\n        Высота макс: {activity.total_elevation_gain}, мин: {activity.average_speed};\r\n        {' '}\r\n        {activity.average_heartrate && <>Пульс: средн: {activity.average_heartrate}, макс: {activity.max_heartrate};</>}\r\n        {' '}\r\n        Средняя скорость {activity.average_speed};\r\n    </a>\r\n    ;\r\n};\r\n\r\nActivityItem.propTypes = {\r\n    activity: PropTypes.shape({\r\n/*\r\n* achievement_count: 0\r\nathlete: {id: 12602406, resource_state: 1}\r\nathlete_count: 2\r\naverage_cadence: 46.2\r\naverage_heartrate: 109.6\r\naverage_speed: 1.15\r\ncomment_count: 0\r\ncommute: false\r\ndisplay_hide_heartrate_option: true\r\ndistance: 15153.2\r\nelapsed_time: 19210\r\ntotal_elevation_gain: 268.6\r\naverage_speed: 171.1\r\nend_latlng: (2) [53.22, 44.91]\r\nexternal_id: \"b1046a83-5025-48bc-81a6-ff2ed5ebf35b-activity.fit\"\r\nflagged: false\r\nfrom_accepted_tag: false\r\ngear_id: \"g6417986\"\r\nhas_heartrate: true\r\nhas_kudoed: false\r\nheartrate_opt_out: false\r\nid: 5872168321\r\nkudos_count: 7\r\nlocation_city: null\r\nlocation_country: \"Russia\"\r\nlocation_state: null\r\nmanual: false\r\nmap: {id: \"a5872168321\", summary_polyline: \"gfzcIyicqGSNJQE_AHAMGDI_@wAEeBN}@\\\\u@KyAjAO@]LM?eCJ…BLu@Km@EoIOq@GeBi@YM}@KMmAV]ZMKGe@a@i@EeAJQlANEh@\", resource_state: 2}\r\nmax_heartrate: 148\r\nmax_speed: 4\r\nmoving_time: 13179\r\nname: \"Полуденная ходьба\"\r\nphoto_count: 0\r\npr_count: 0\r\nprivate: false\r\nresource_state: 2\r\nstart_date: \"2021-08-29T08:14:02Z\"\r\nstart_date_local: \"2021-08-29T11:14:02Z\"\r\nstart_latitude: 53.22\r\nstart_latlng: (2) [53.22, 44.91]\r\nstart_longitude: 44.91\r\ntimezone: \"(GMT+03:00) Europe/Moscow\"\r\ntotal_elevation_gain: 189.2\r\ntotal_photo_count: 16\r\ntrainer: false\r\ntype: \"Walk\"\r\nupload_id: 6243513574\r\nupload_id_str: \"6243513574\"\r\nutc_offset: 10800\r\nvisibility: \"everyone\"\r\n\r\n* */\r\n    }).isRequired,\r\n};\r\n\r\nexport default ActivityItem;\r\n","let debounceTimeout;\r\nexport const debounceAsync = (duration = 600) => {\r\n    clearTimeout(debounceTimeout);\r\n\r\n    return new Promise(resolve => {\r\n        debounceTimeout = setTimeout(() => resolve(), duration);\r\n    });\r\n}","import { createContext } from 'react';\r\nexport const UserContext = createContext(null);\r\n","import styles from './styles.module.css';\r\nimport {useEffect} from \"react\";\r\nimport * as ReactDOM from \"react-dom\";\r\nconst Modal = ({ children, onClose }) => {\r\n    useEffect(() => {\r\n        document.body.style.overflow = 'hidden';\r\n        return () => document.body.style.overflow = '';\r\n    }, []);\r\n\r\n    return <div className={styles.overlay} onClick={onClose}>\r\n        <div className={styles.modal} onClick={e => e.stopPropagation()}>\r\n            {typeof children === 'function' ? children(onClose) : children}\r\n        </div>\r\n    </div>\r\n}\r\n\r\nexport const showModal = props => {\r\n    const container = document.createElement('div');\r\n    document.body.appendChild(container);\r\n\r\n    ReactDOM.render(<Modal {...props} onClose={() => {\r\n        ReactDOM.unmountComponentAtNode(container);\r\n        document.body.removeChild(container)\r\n    }} />, container)\r\n}\r\n\r\nexport default Modal;\r\n","import styles from './styles.module.css';\r\nimport React, {useEffect, useState} from \"react\";\r\nimport {debounceAsync} from \"../../helpers/debounceHelper\";\r\nimport {showModal} from \"../Modal\";\r\nimport ActivityItem from \"../Activities/components/ActivityItem\";\r\n\r\nconst showDay = (x) => {\r\n    // window.confirm([formatDistance(x.dist), ...x.acts.map(x => '• ' + x.name)].join('\\n'))\r\n    showModal({children: <div>\r\n            {x.acts.map(a => <ActivityItem key={a.id} activity={a} />)}\r\n        </div>})\r\n}\r\n\r\nconst getMonthName = date => {\r\n    const months = ['янв', 'фев', 'мар', 'апр', 'май', 'июн', 'июл', 'авг', 'сен', 'окт', 'ноя', 'дек'];\r\n    return `${months[date.getMonth()].toUpperCase()}'${date.getFullYear().toString().substr(-2)}`;\r\n}\r\n\r\nconst defaultZoom = 16;\r\n\r\nconst Chart = ({activities}) => {\r\n    const [size, setSize] = useState(+localStorage.getItem('stravastatZoom') || defaultZoom);\r\n\r\n\r\n    useEffect(async () => localStorage.setItem('stravastatZoom', size), [size]);\r\n\r\n\r\n    if(!activities[0]) {\r\n        return '🐱‍🚀';\r\n    }\r\n\r\n    const minD = new Date(Date.parse(activities[0].start_date));\r\n    const maxD = new Date(Date.parse(activities[activities.length - 1].start_date)+86400000);\r\n    const shif = minD.getDay() === 0 ? 6 : minD.getDay()-1\r\n\r\n    const agg = [];\r\n    const mo = [];\r\n    let cur = minD.getTime();\r\n    let w=0;\r\n    while (cur < maxD.getTime()) {\r\n        const actual = activities.filter(x => {\r\n            return new Date(Date.parse(x.start_date)).toISOString().substr(0,10) === new Date(cur).toISOString().substr(0,10)\r\n        });\r\n\r\n        if (new Date(cur).getDay() === 6) {\r\n            w += 1;\r\n        }\r\n\r\n        if (new Date(cur).getMonth() !== new Date(cur+86_400_000).getMonth()) {\r\n            mo.push({ m: getMonthName(new Date(cur)), w })\r\n            w = 0;\r\n        }\r\n        agg.push({ date: cur, cou: actual.length, acts: actual, dist: actual.reduce((s,x)=>x.distance + s,0) });\r\n\r\n        cur += 86_400_000;\r\n    }\r\n    mo.push({ m: getMonthName(new Date(cur)),w})\r\n    w = 0;\r\n\r\n    const filledActivities = agg.filter(x => x.dist > 0);\r\n\r\n    if (!filledActivities?.length) {\r\n        return null;\r\n    }\r\n\r\n    const max = filledActivities.reduce((prev, curr) => prev.dist > curr.dist ? prev.dist : curr.dist);\r\n\r\n    const handleZoom = coeff => async () => {\r\n        await debounceAsync(100);\r\n        setSize(cur => cur + coeff)\r\n    }\r\n\r\n\r\n    return <section  className={styles.chartSection}>\r\n        <header className={styles.chartSectionHeader}>\r\n            <h3>Карта активности</h3>\r\n            <div>\r\n                {size > defaultZoom && <button onClick={handleZoom(-2)}>\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\"\r\n                         className=\"bi bi-zoom-out\" viewBox=\"0 0 16 16\">\r\n                        <path fillRule=\"evenodd\"\r\n                              d=\"M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z\"/>\r\n                        <path\r\n                            d=\"M10.344 11.742c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1 6.538 6.538 0 0 1-1.398 1.4z\"/>\r\n                        <path fillRule=\"evenodd\" d=\"M3 6.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z\"/>\r\n                    </svg>\r\n                </button>}\r\n                <button onClick={handleZoom(2)}>\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\"\r\n                         className=\"bi bi-zoom-in\" viewBox=\"0 0 16 16\">\r\n                        <path fillRule=\"evenodd\"\r\n                              d=\"M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z\"/>\r\n                        <path\r\n                            d=\"M10.344 11.742c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1 6.538 6.538 0 0 1-1.398 1.4z\"/>\r\n                        <path fillRule=\"evenodd\"\r\n                              d=\"M6.5 3a.5.5 0 0 1 .5.5V6h2.5a.5.5 0 0 1 0 1H7v2.5a.5.5 0 0 1-1 0V7H3.5a.5.5 0 0 1 0-1H6V3.5a.5.5 0 0 1 .5-.5z\"/>\r\n                    </svg>\r\n                </button>\r\n            </div>\r\n        </header>\r\n        <div className={styles.chart} style={{ fontSize: size + 'px' }}>\r\n        <div className={styles.daysName}>\r\n            <div><small>пн</small></div>\r\n            <div><small>вт</small></div>\r\n            <div><small>ср</small></div>\r\n            <div><small>чт</small></div>\r\n            <div><small>пт</small></div>\r\n            <div><small>сб</small></div>\r\n            <div><small>вс</small></div>\r\n        </div>\r\n        <div className={styles.main}>\r\n            <div className={styles.monthsBar}>\r\n                {mo.map(m => <div key={m.m} className={styles.month + ' '+styles['m'+m.w]}>\r\n                <small>{m.m}</small>\r\n            </div>)}</div>\r\n            <div className={styles.container}>\r\n                {shif> 0 && new Array(shif).fill(true).map((a,x) => <div key={x} className={styles.empty_point} />)}\r\n                {agg.map((x, i) => {\r\n                    return <div\r\n                        title={new Date(x.date)} className={x.cou>0 ? styles.point:styles.empty_point}\r\n                        key={x.date}\r\n                        style={x.dist > 0 ? {backgroundColor:`rgba(252,82,0,${(x.dist / max)})`}:{}}\r\n                        onClick={x.dist > 0 ? () => showDay(x) : () => {} }\r\n                    >\r\n                        <small>\r\n                            {new Date(x.date).getDate()}\r\n                        </small>\r\n                    </div>\r\n                })}\r\n            </div>\r\n        </div>\r\n    </div>\r\n    </section>\r\n}\r\n\r\nexport default Chart;\r\n","import React from 'react';\r\nimport styles from './styles.module.css';\r\n\r\nconst Card = ({title, children, unit}) => {\r\n    return <div className={styles.card}>\r\n        <h3 className={styles.cardTitle}>{title}</h3>\r\n        <div className={styles.cardContent}>{children}{unit && <>&thinsp;<small>{unit}</small></>}</div>\r\n    </div>;\r\n};\r\n\r\nexport default Card;\r\n","import Card from \"../Card\";\r\nimport {formatDistance} from \"../../../../helpers/formatHelper\";\r\nimport styles from './style.module.css';\r\n\r\nconst Widget = ({ distance, total_elevation_gain, average_speed, moving_time, count }) => {\r\n    const [d, dU] = formatDistance(distance, true);\r\n    const [h, hU] = formatDistance(total_elevation_gain, true);\r\n\r\n    return <section className={styles.widgetContainer}>\r\n        <Card title={'Дистанция'} unit={dU}>{d}</Card>\r\n        <Card title={'Набор'} unit={hU}>{h}</Card>\r\n        <Card title={'Сброс'} unit={'км/ч'}>{Math.round(average_speed/count)}</Card>\r\n        <Card title={'В движении'} unit=\"ч\">{(moving_time / 60 / 60).toFixed(2)}</Card>\r\n    </section>\r\n}\r\n\r\nexport default Widget;\r\n","import styles from './styles.module.css';\r\nimport React from \"react\";\r\n\r\nconst Loader = () => {\r\n    return <div className={styles.loader}>\r\n        <div />\r\n        <div />\r\n        <div />\r\n        <div />\r\n        <div />\r\n        <div />\r\n    </div>;\r\n}\r\n\r\nexport default Loader;\r\n","export default __webpack_public_path__ + \"static/media/long-512_orange.6e6363f9.png\";","export const getLatLonAsGpx = (latlon, name = 'stravastat') => {\r\n    const str = `\r\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\" ?>\r\n<gpx xmlns=\"http://www.topografix.com/GPX/1/1\" creator=\"https://stravastat.github.io\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd\" version=\"1.1\">\r\n    <metadata>\r\n        <time>2021-09-15T19:05:49.078Z</time>\r\n    </metadata>\r\n    <trk>\r\n        <name>${name}</name>\r\n        <trkseg>\r\n            ${latlon.map(([lat, lon]) => `<trkpt lat=\"${lat}\" lon=\"${lon}\"><time>1970-01-01T00:00:01.000Z</time></trkpt>`).join('\\r\\n')}\r\n        </trkseg>\r\n    </trk>\r\n</gpx>`;\r\n\r\n\r\n    const url = 'data:application/gpx+xml;charset=utf-8,' + str.trim();\r\n    return url;\r\n}\r\n\r\nexport const getGPXFileAsync = (latlon, name = 'stravastat') => {\r\n    return fetch(getLatLonAsGpx(latlon, name))\r\n        .then(res => res.blob())\r\n        .then(blob => {\r\n            const file = new File([blob], name+'.txt',{ type: \"text/plain\" })\r\n            return file\r\n        })\r\n}\r\n\r\n\r\nexport const downloadLatLonAsGpx = (latlon, name = 'stravastat') => {\r\n    const url = getLatLonAsGpx(latlon, name);\r\n    const link = document.createElement('a');\r\n    link.download = `${name}.gpx`;\r\n    link.href = url;\r\n    link.click();\r\n}\r\n","import { formatDistance } from '../../helpers/formatHelper';\r\nimport polyline from '@mapbox/polyline';\r\nimport { downloadLatLonAsGpx, getGPXFileAsync } from '../../helpers/gpxHelper';\r\n\r\nexport const getPopupContentForActivity = activity => {\r\n\r\n    const { map: {summary_polyline} } = activity;\r\n\r\n    const div = document.createElement('div');\r\n    div.innerText = `${new Date(Date.parse(activity.start_date_local) - (activity.utc_offset * 1000)).toLocaleString()}\r\n                    ${activity.name} (${formatDistance(activity.distance)})`;\r\n\r\n    const footer = document.createElement('footer');\r\n    footer.style.marginTop = '12px';\r\n\r\n    if (summary_polyline?.length) {\r\n        const btn = document.createElement('button');\r\n        btn.innerText = '⇩ GPX';\r\n        btn.style.marginRight = '10px'\r\n        btn.onclick = () => {\r\n            const latLon = polyline.decode(summary_polyline);\r\n            downloadLatLonAsGpx(latLon, `${activity.name} ${formatDistance(activity.distance)}`)\r\n        }\r\n\r\n        footer.appendChild(btn)\r\n\r\n\r\n        if (window.navigator.canShare) {\r\n            const btn = document.createElement('button');\r\n            btn.innerText = 'Share';\r\n            btn.style.marginRight = '10px'\r\n            btn.onclick = () => {\r\n                const latLon = polyline.decode(summary_polyline);\r\n                getGPXFileAsync(latLon, `${activity.name} ${formatDistance(activity.distance)}`)\r\n                    .then(file => {\r\n                        const filesArray = [file];\r\n                        const shareData = { files: filesArray };\r\n                        if (navigator.canShare && navigator.canShare(shareData)) {\r\n\r\n                            /* Добавляем заголовок после того, как navigator.canShare принимает файлы */\r\n                            shareData.title = `${activity.name} ${formatDistance(activity.distance)}`\r\n\r\n                            console.log(shareData)\r\n                            navigator.share(shareData)\r\n                                .then(() => console.log('Share was successful.'))\r\n                                .catch((error) => console.log('Sharing failed', error));\r\n\r\n                        } else {\r\n                            console.log(\"Your system doesn't support sharing files.\");\r\n                        }\r\n                    })\r\n            }\r\n\r\n            footer.appendChild(btn)\r\n        }\r\n    }\r\n\r\n    const a = document.createElement('a');\r\n    a.href = `https://www.strava.com/activities/${activity.id}`;\r\n    a.rel=\"noreferrer\";\r\n    a._target=\"_blank\";\r\n    a.innerText = 'Открыть в Strava';\r\n\r\n    footer.appendChild(a);\r\n    div.appendChild(footer);\r\n\r\n\r\n    return div\r\n}\r\n","import React, { useEffect, useState, useRef, useContext, useCallback } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport * as L from 'leaflet';\r\nimport polyline from '@mapbox/polyline';\r\nimport localDB from '../../services/indexedDBService';\r\nimport { getActivitiesAsync } from '../../services/activitiesService';\r\nimport ActivityItem from './components/ActivityItem';\r\nimport { clearMap } from '../../helpers/mapHelper';\r\nimport styles from './styles.module.css'\r\nimport { UserContext } from '../../contexts/userContext';\r\nimport Chart from \"../Chart\";\r\nimport {debounceAsync} from \"../../helpers/debounceHelper\";\r\nimport Widget from \"./components/Widget\";\r\nimport Loader from '../Loader';\r\nimport 'leaflet/dist/leaflet.css';\r\nimport '../../libs/leaflet-fullscreen/Leaflet.fullscreen';\r\nimport '../../libs/leaflet-fullscreen/leaflet.fullscreen.css';\r\nimport logo from '../../images/long-512_orange.png'\r\nimport { getPopupContentForActivity } from './helpers';\r\nimport {saveJSONAsFile, saveArrayAsCSV} from \"../../helpers/downloadHelper\";\r\n\r\nconst now = new Date();\r\nconst defaultD1 = new Date(now.getFullYear(), 0, 1, 4, 0, 0, 1);\r\nconst defaultD2 = new Date(now.getFullYear(), 11, 31, 23, 59, 59, 999);\r\nconst minDate = '2007-01-01'\r\n\r\nconst Activities = ({ token }) => {\r\n    const [d1, setD1] = useState(localStorage.getItem('stravastatD1') || defaultD1.toISOString().substr(0,10));\r\n    const [d2, setD2] = useState(localStorage.getItem('stravastatD2') || defaultD2.toISOString().substr(0,10));\r\n    const [types, setTypes] = useState([]);\r\n    const [loading, setIsLoading] = useState(false);\r\n    const [type, setType] = useState(localStorage.getItem('stravastatType') || \"\");\r\n    const [activities, setActivities] = useState(null);\r\n    const mapRef = useRef();\r\n    const mapContainerRef = useRef();\r\n    const user = useContext(UserContext);\r\n\r\n    useEffect(() => {\r\n        localDB.getAllActivity().then(res => {\r\n            console.log('activities', { res });\r\n            setActivities(res);\r\n            if (!res.length) {\r\n                handleUpdate(true);\r\n            }\r\n        });\r\n    }, [handleUpdate]);\r\n\r\n    useEffect(() => localStorage.setItem('stravastatD1', d1), [d1]);\r\n    useEffect(() => localStorage.setItem('stravastatD2', d2), [d2]);\r\n    useEffect(() => localStorage.setItem('stravastatType', type), [type])\r\n\r\n    useEffect(() => {\r\n        activities?.length && setTypes(activities.reduce((acc, {type}) => ({...acc, [type]: (acc[type] || 0) + 1}), {}));\r\n    }, [activities]);\r\n\r\n    useEffect(()=> {\r\n        if (!mapContainerRef?.current) {\r\n            return;\r\n        }\r\n\r\n        if (!mapRef?.current) {\r\n            mapRef.current = L.map(\r\n                mapContainerRef.current,\r\n                {\r\n                    fullscreenControl: {\r\n                        pseudoFullscreen: false // if true, fullscreen to page width and height\r\n                    }\r\n                }\r\n            ).setView([53.2006600, 45.0046400], 12);\r\n\r\n            L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n                attribution: ' | <a href=\"http://openstreetmap.org\">OpenStreetMap</a> | <b><a href=\"https://stravastat.github.io\">stravastat.github.io</a></b>',\r\n                maxZoom: 20,\r\n                id: 'osm'\r\n            }).addTo(mapRef.current);\r\n\r\n            L.Control.Watermark = L.Control.extend({\r\n                onAdd: function(map) {\r\n                    const img = L.DomUtil.create('img');\r\n\r\n                    img.src = logo;\r\n                    img.style.height = '24px';\r\n                    img.style.opacity = '0.64';\r\n\r\n                    return img;\r\n                },\r\n\r\n                onRemove: function(map) {\r\n                    // Nothing to do here\r\n                }\r\n            });\r\n\r\n            L.control.watermark = function(opts) {\r\n                return new L.Control.Watermark(opts);\r\n            }\r\n\r\n            L.control.watermark({ position: 'bottomleft' }).addTo(mapRef.current);\r\n        }\r\n\r\n\r\n\r\n        const boundCoordinates = [];\r\n\r\n        clearMap(mapRef.current);\r\n        const filtredActivities = activities && activities.filter(x => {\r\n            const dX = Date.parse(x.start_date_local);\r\n            const dS = Date.parse(d1);\r\n            const dE = Date.parse(d2);\r\n\r\n            return (!type || x.type === type) && dX >= dS && dX <= dE;\r\n        });\r\n        filtredActivities?.forEach(activity => {\r\n            const { map: {summary_polyline} } = activity;\r\n            if (summary_polyline?.length) {\r\n                const coords = polyline.decode(summary_polyline);\r\n                L.polyline(coords)\r\n                    .setStyle({\r\n                        color: 'rgba(255, 0, 0,0.5)'\r\n                    })\r\n                    .bindPopup(getPopupContentForActivity(activity))\r\n                    .addTo(mapRef.current)\r\n                boundCoordinates.push(coords)\r\n            }\r\n        })\r\n\r\n        const bounds = L.latLngBounds(boundCoordinates);\r\n        boundCoordinates?.length && mapRef.current.fitBounds(bounds);// works!\r\n\r\n    }, [mapContainerRef, activities, type, d1, d2]);\r\n\r\n\r\n\r\n    const filtredActivities = activities && activities.filter(x => {\r\n        const dX = Date.parse(x.start_date_local);\r\n        const dS = Date.parse(d1);\r\n        const dE = Date.parse(d2);\r\n\r\n        return (!type || x.type === type) && dX >= dS && dX <= dE;\r\n    })\r\n\r\n\r\n    const aggreg = filtredActivities?.reduce((acc, val) => {\r\n        return {\r\n            distance: acc.distance + val.distance,\r\n            total_elevation_gain: acc.total_elevation_gain + val.total_elevation_gain || 0,\r\n            average_speed: acc.average_speed + val.average_speed || 0,\r\n            elapsed_time: acc.elapsed_time + val.elapsed_time,\r\n            moving_time: acc.moving_time + val.moving_time\r\n        };\r\n    }, { distance: 0, total_elevation_gain: 0, average_speed: 0, elapsed_time: 0, moving_time: 0 })\r\n\r\n    const handleChangeD1 = async (e) => { const value = e.target.value; await debounceAsync(); setD1(value); }\r\n    const handleChangeD2 = async (e) => { const value = e.target.value; await debounceAsync(); setD2(value); }\r\n    const limit = 50;\r\n\r\n    var handleUpdate = useCallback(async function (isInitial = false) {\r\n        setIsLoading(true);\r\n        let lastBatch = activities;\r\n        let lastActivityDate = lastBatch?.length\r\n            ? new Date(Date.parse(lastBatch[lastBatch.length - 1].start_date))\r\n            : new Date(Date.parse(minDate));\r\n\r\n        let page = 0;\r\n        while (page === 0 || lastBatch?.length > 0) {\r\n            page++;\r\n            console.log('page', page);\r\n\r\n            lastBatch = await getActivitiesAsync(\r\n                token,\r\n                Math.floor(lastActivityDate.getTime() / 1000),\r\n                Math.floor(new Date().getTime() / 1000),\r\n                page,\r\n                limit\r\n            );\r\n\r\n            console.time('addDB');\r\n            await localDB.addActivities(lastBatch).catch(e => console.error(e));\r\n            console.timeEnd('addDB');\r\n        }\r\n\r\n        if (isInitial) {\r\n            window.location.reload();\r\n        }\r\n        setIsLoading(false)\r\n    }, [activities, token]);\r\n\r\n    if (loading && !activities?.length) { //\r\n        return <div className={styles.loader}>\r\n            <Loader />\r\n            <p align=\"center\">Загрузка<br />активностей</p>\r\n        </div>\r\n    }\r\n\r\n    return <div>\r\n        <button className={styles.floatButton} disabled={loading} onClick={handleUpdate}>\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 16 16\">\r\n                <path\r\n                    d=\"M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z\"/>\r\n                <path d=\"M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z\"/>\r\n            </svg>\r\n        </button>\r\n        <div className={styles.form}>\r\n            <div className={styles.dates}><input\r\n                type=\"date\"\r\n                value={d1}\r\n                min={minDate}\r\n                max={d2.substr(0,10)}\r\n                onChange={handleChangeD1}\r\n            />\r\n            -\r\n            <input\r\n                type=\"date\"\r\n                value={d2}\r\n                min={d1.substr(0,10)}\r\n                max={new Date().toISOString().substr(0,10)}\r\n                onChange={handleChangeD2}\r\n            />\r\n            </div>\r\n            {' \\u00a0 '}\r\n            <select onChange={e => setType(e.target.value)} value={type}>\r\n                <option value=\"\">Все виды активностей</option>\r\n                {types && Object.entries(types).map(([x,v]) => (\r\n                    <option key={x} value={x}>{x} ({v})</option>\r\n                ))}\r\n            </select>\r\n        </div>\r\n        {\r\n            aggreg && <Widget\r\n                distance={aggreg.distance}\r\n                total_elevation_gain={aggreg.total_elevation_gain}\r\n                average_speed={aggreg.average_speed}\r\n                moving_time={aggreg.moving_time}\r\n                count={filtredActivities.length}\r\n            />\r\n        }\r\n        {filtredActivities?.length > 0 && <Chart activities={filtredActivities} />}\r\n        {!activities && <div className={styles.loader}><Loader /></div>}\r\n        {filtredActivities && <div ref={mapContainerRef} style={{height:'300px'}}/>}\r\n        &nbsp;\r\n        <button onClick={() => saveJSONAsFile('stravastat_data.json', activities)}>Экспорт JSON</button>\r\n        &nbsp;\r\n        <button onClick={() => saveArrayAsCSV(\r\n            'stravastat_data.csv',\r\n            activities.map(({name, start_date_local})=>([name.trim(), start_date_local]))\r\n        )}>Экспорт CSV</button>\r\n        <section>\r\n            {filtredActivities && filtredActivities.map(x => <ActivityItem key={x.id} activity={x} /> )}\r\n        </section>\r\n    </div>;\r\n};\r\n\r\nActivities.propTypes = {\r\n    token: PropTypes.string,\r\n};\r\n\r\nexport default Activities;\r\n","export function clearMap(map) {\r\n    map.eachLayer((layer) => {\r\n        const hasEmptyContrib = !(layer.getAttribution && layer.getAttribution());\r\n        const hasNoContrib = !layer.getAttribution;\r\n        if (hasEmptyContrib || hasNoContrib) {\r\n            map.removeLayer(layer);\r\n        }\r\n    })\r\n}\r\n","export const saveJSONAsFile = (filename, dataObjToWrite) => {\r\n    const blob = new Blob([JSON.stringify(dataObjToWrite)], { type: \"text/json\" });\r\n    const link = document.createElement(\"a\");\r\n\r\n    link.download = filename;\r\n    link.href = window.URL.createObjectURL(blob);\r\n    link.dataset.downloadurl = [\"text/json\", link.download, link.href].join(\":\");\r\n\r\n    const evt = new MouseEvent(\"click\", {\r\n        view: window,\r\n        bubbles: true,\r\n        cancelable: true,\r\n    });\r\n\r\n    link.dispatchEvent(evt);\r\n    link.remove()\r\n};\r\n\r\nexport const saveArrayAsCSV = (filename, arrOfArr) => {\r\n    const blob = new Blob([arrOfArr.map(s => s.join(',\\t')).join('\\r\\n')], { type: \"text/json\" });\r\n    const link = document.createElement(\"a\");\r\n\r\n    link.download = filename;\r\n    link.href = window.URL.createObjectURL(blob);\r\n    link.dataset.downloadurl = [\"text/csv\", link.download, link.href].join(\":\");\r\n\r\n    const evt = new MouseEvent(\"click\", {\r\n        view: window,\r\n        bubbles: true,\r\n        cancelable: true,\r\n    });\r\n\r\n    link.dispatchEvent(evt);\r\n    link.remove()\r\n};","import styles from './styles.module.css';\r\n\r\nconst FullScreen = ({ children, className }) => {\r\n    return <section className={[styles.fullScreen,className].join(' ')}>\r\n        {children}\r\n    </section>;\r\n}\r\n\r\nexport default FullScreen;\r\n","import { getAuthLink } from '../../services/authService';\r\nimport FullScreen from '../FullScreen';\r\n\r\nconst Welcome = () => {\r\n    return <FullScreen>\r\n        <p align=\"center\">\r\n            Это приложение покажет<br />\r\n            статистику ваших активностей<br />\r\n            в новом виде 😎\r\n            <br />\r\n            <br />\r\n            Для продолжения нужно\r\n            <br />\r\n            <button  className=\"bigButton\" onClick={() => window.location.href = getAuthLink()}>Войти в Strava</button>\r\n        </p>\r\n    </FullScreen>;\r\n}\r\n\r\nexport default Welcome;\r\n","import styles from './styles.module.css';\r\n\r\nconst Donate = ({ onClose }) => {\r\n    return <div className={styles.menu}>\r\n        <header className={styles.header}>\r\n            <strong>STRAVASTAT</strong>\r\n            <button onClick={onClose}>×</button>\r\n        </header>\r\n        <section className={styles.content}>\r\n            <iframe src=\"https://yoomoney.ru/quickpay/shop-widget?writer=seller&targets=%D0%9D%D0%B0%20%D0%BA%D0%BE%D1%84%D0%B5%20%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%87%D0%B8%D0%BA%D1%83%20%E2%98%95&targets-hint=&default-sum=55&button-text=12&comment=on&hint=%D0%B8%D0%BB%D0%B8%20%D0%B8%D0%B4%D0%B5%D1%8F%20%D0%B4%D0%BB%D1%8F%20%D1%80%D0%B0%D0%B7%D0%B2%D0%B8%D1%82%D0%B8%D1%8F%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B0&successURL=https%3A%2F%2Fstravastat.github.io%2F%23thanksForDonation&quickpay=shop&account=410011057543275\" width=\"100%\" height=\"314\"\r\n                    frameBorder=\"0\" scrolling=\"no\"></iframe>\r\n        </section>\r\n    </div>\r\n}\r\n\r\n\r\nexport default Donate;\r\n","import { unAuthorizeAsync } from '../../services/authService';\r\nimport localDB from '../../services/indexedDBService';\r\nimport styles from './styles.module.css';\r\nimport { showModal } from '../Modal';\r\nimport Donate from '../Donate';\r\n\r\nconst Menu = ({ onClose }) => {\r\n    const handleLogout = async (e) => {\r\n        if (!window.confirm('Приложение будет разлогинено, сохраненные данные будут удалены. \\r\\nПродолжить?')) {return;}\r\n        e.target.disabled = true;\r\n        await unAuthorizeAsync();\r\n        await localDB.clear();\r\n        window.location.reload();\r\n    }\r\n\r\n    const handleShare = () => {\r\n        navigator.share({\r\n            title: \"stravastat\",\r\n            text: \"Сервис анализа тренировок Strava\",\r\n            url: 'https://stravastat.github.io/'\r\n        })\r\n            .then(function () {\r\n                console.log(\"Shareing successfull\")\r\n            })\r\n            .catch(function () {\r\n                console.log(\"Sharing failed\")\r\n            })\r\n    }\r\n\r\n    const handleDonate = () => {\r\n        showModal({children: onClose => <Donate onClose={onClose} />})\r\n    }\r\n\r\n    return <div className={styles.menu}>\r\n        <header className={styles.header}>\r\n            <strong>STRAVASTAT</strong>\r\n            <button onClick={onClose}>×</button>\r\n        </header>\r\n        <section className={styles.content}>\r\n            <div>\r\n                <p><b>Сервис анализа тренировок Strava</b></p>\r\n                <p>\r\n                    Может использоваться:\r\n                    <ul>\r\n                        <li>Как веб-сайт <a href=\"https://stravastat.github.io/\" target=\"_blank\">stravastat.github.io</a> на любом устройстве</li>\r\n                        <li>\r\n                            Как прогрессивное веб приложение (PWA) устанавливаемое на устроство (например смартфон на android)\r\n                            <br />\r\n                            <small>Актуальную версию можно установить с сайта <a href=\"https://stravastat.github.io/\" target=\"_blank\">stravastat.github.io</a> предварительно удалив <b>Stravastat</b> из списка приложений </small>\r\n                        </li>\r\n                    </ul>\r\n                </p>\r\n                <p>Сервис использует данные об активностях пользователя <a href=\"https://www.strava.com/\" target=\"_blank\">www.strava.com</a></p>\r\n                <p>\r\n                    Тренировки загружаются в локальное хранилище один раз при инициализации приложения и доступны даже <b>offline</b> <br />\r\n                    <small>наличие на устройстве приложения <a href={\"https://osmand.net/ru/\"} target=\"_blank\">osmand</a> с установленными картами позволяет просматривать треки тренировок на карте без доступа к интернету</small>\r\n                </p>\r\n                <p>\r\n                Based on API <a href=\"https://www.strava.com/\" target=\"_blank\">strava</a>\r\n                {' and '}\r\n                <a href=\"https://www.openstreetmap.org/\" target=\"_blank\">openstreetmap</a>\r\n            </p>\r\n            </div>\r\n            <div>\r\n                <button onClick={handleDonate}>Поддержать ☕</button>\r\n            </div>\r\n\r\n        </section>\r\n        <footer className={styles.footer}>\r\n            <button onClick={handleLogout} style={{backgroundColor:'#adadad', borderColor:'#777777'}}>Выйти</button>\r\n            2021 <p>© Created by <a href=\"https://www.strava.com/athletes/12602406\" target=\"_blank\">Fedoseev Nikolay</a></p>\r\n        </footer>\r\n    </div>\r\n}\r\n\r\n\r\nexport default Menu;\r\n","import { useEffect, useState } from 'react';\r\nimport './App.css';\r\nimport {\r\n    getAuthLink,\r\n    getAuthTokenAsync,\r\n    setAuthTokenByCodeAsync,\r\n    getUser\r\n} from './services/authService';\r\nimport Profile from './components/Profile';\r\nimport Activities from './components/Activities';\r\nimport { UserContext } from './contexts/userContext';\r\nimport Welcome from './components/Welcome';\r\nimport FullScreen from './components/FullScreen';\r\nimport Loader from './components/Loader';\r\nimport localDB from './services/indexedDBService';\r\nimport { showModal } from './components/Modal';\r\nimport Menu from './components/Menu';\r\n\r\nconst dbName = 'stravastat';\r\nconst dbVersion = 1;\r\n\r\n\r\n\r\nfunction App() {\r\n    const [token, setToken] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [dbLoading, setDbLoading] = useState(true);\r\n    const [err, setErr] = useState(null);\r\n\r\n    useEffect(() => {\r\n        const params = new URLSearchParams(window.location.search);\r\n        const code = params.get('code');\r\n\r\n        if(code?.length) {\r\n            const getUserData = async () => {\r\n                setLoading(true);\r\n                try {\r\n                    await setAuthTokenByCodeAsync(code);\r\n                    window.history.pushState({},'', '/');\r\n                    window.location.reload();\r\n                    //window.location.href = window.location.href.replace(window.location.search, '');\r\n                } catch (e) {\r\n                    setErr(e.message)\r\n                    window.location.href = getAuthLink();\r\n                }\r\n                finally {\r\n                    setLoading(false);\r\n                }\r\n            }\r\n            return getUserData();\r\n        } else {\r\n            const getStoredData = async () => {\r\n                setLoading(true);\r\n                try {\r\n                    const token = await getAuthTokenAsync();\r\n                    setToken(token);\r\n                } catch (e) {\r\n                    console.log(e)\r\n                    //window.location.href = getAuthLink();\r\n                } finally {\r\n                    setLoading(false);\r\n                }\r\n            }\r\n\r\n            getStoredData();\r\n        }\r\n\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        setDbLoading(true);\r\n        localDB.init(dbName, dbVersion)\r\n            .then(() => {})\r\n            .catch(() => setErr('Ошибка инициализации БД'))\r\n            .finally(() => setDbLoading(false))\r\n    }, [])\r\n\r\n    if (loading || dbLoading) {\r\n        return <FullScreen><Loader /></FullScreen>;\r\n    }\r\n\r\n\r\n\r\n    const handleMenu = () => {\r\n        showModal({children: onClose => <Menu onClose={onClose} />})\r\n    }\r\n\r\n  return (\r\n    <div className=\"App\">\r\n        {err && <p>{err}</p>}\r\n        {token && <UserContext.Provider value={getUser()}>\r\n            <header className=\"header\">\r\n                <Profile />\r\n                <button onClick={handleMenu}>☰</button>\r\n            </header>\r\n            <Activities token={token} />\r\n        </UserContext.Provider>}\r\n        {!token && <Welcome />}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import styles from './styles.module.css';\r\n\r\nconst Thanks = ({ onClose }) => {\r\n    return <div className={styles.menu}>\r\n        <header className={styles.header}>\r\n            <strong>STRAVASTAT</strong>\r\n\r\n        </header>\r\n        <section className={styles.content}>\r\n            <h2>Пасиб 😊</h2>\r\n            <button onClick={() => { window.location.hash = ''; onClose(); }}>К приложению</button>\r\n        </section>\r\n    </div>\r\n}\r\n\r\n\r\nexport default Thanks;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport { showModal } from './components/Modal';\r\nimport Thanks from './components/Thanks';\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\nwindow.onload = () => {\r\n    if (window.location.hash === '#thanksForDonat') {\r\n        showModal({children: onClose => <Thanks onClose={onClose} />})\r\n    }\r\n}\r\n"],"sourceRoot":""}
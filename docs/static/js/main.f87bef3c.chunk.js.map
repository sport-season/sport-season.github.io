{"version":3,"sources":["components/Chart/styles.module.css","services/authService.js","components/Profile/index.js","services/indexedDBService.js","services/activitiesService.js","helpers/formatHelper.js","components/Activities/components/ActivityItem/index.js","helpers/debounceHelper.js","components/Activities/components/Card/index.js","contexts/userContext.js","components/Modal/index.js","components/Chart/index.js","components/Activities/components/Widget/index.js","components/Activities/index.js","helpers/mapHelper.js","App.js","index.js","components/Profile/styles.module.css","components/Activities/components/Card/styles.module.css","components/Activities/styles.module.css","components/Activities/components/ActivityItem/styles.module.css","components/Modal/styles.module.css"],"names":["module","exports","client_id","client_secret","lsTokenKey","lsUserKey","getAuthLink","data","redirect_uri","window","location","origin","response_type","approval_prompt","scope","searchParams","URLSearchParams","toString","getAuthTokenAsync","a","lsTokenDataStr","localStorage","getItem","length","tData","JSON","parse","expires_at","Date","now","access_token","refresh_token","fetch","body","grant_type","headers","method","then","res","json","result","setItem","stringify","Error","setAuthTokenByCodeAsync","code","console","log","athlete","tokenData","removeItem","Promise","resolve","success","getUser","Profile","props","user","className","styles","prof","src","profile_medium","ava","name","lastname","firstname","instance","version","this","init","openDB","upgrade","db","createObjectStore","keyPath","createIndex","oneOrSeveralObjs","tx","transaction","objectStore","Array","isArray","all","map","obj","store","add","done","getAll","getActivitiesAsync","token","t1","t2","page","limit","Authorization","formatDistance","d","destructure","parts","parseFloat","toFixed","join","ActivityItem","activity","start_date_local","utc_offset","d1","d2","elapsed_time","at","moving_time","href","id","target","item","row","distance","toLocaleString","substr","toLocaleDateString","toLocaleTimeString","elev_high","elev_low","average_heartrate","max_heartrate","average_speed","debounceTimeout","Card","title","children","unit","card","cardTitle","cardContent","UserContext","createContext","debounceAsync","duration","clearTimeout","setTimeout","Modal","onClose","useEffect","document","style","overflow","overlay","onClick","modal","e","stopPropagation","showDay","x","container","createElement","appendChild","ReactDOM","removeChild","showModal","acts","Chart","activities","useState","size","setSize","minD","start_date","maxD","shif","getDay","agg","mo","cur","getTime","w","actual","filter","toISOString","getMonth","push","m","date","cou","dist","reduce","s","filledActivities","max","prev","curr","handleZoom","coeff","chartSection","chartSectionHeader","xmlns","width","height","fill","viewBox","chart","fontSize","daysName","main","monthsBar","month","empty_point","i","point","backgroundColor","getDate","Widget","dU","h","hU","l","lU","display","marginTop","padding","defaultD1","getFullYear","defaultD2","Activities","setD1","setD2","types","setTypes","loading","setIsLoading","type","setType","setActivities","mapRef","useRef","mapContainerRef","useContext","localDB","getAllActivity","handleUpdate","acc","current","L","fullscreenControl","setView","attribution","maxZoom","addTo","boundCoordinates","eachLayer","layer","hasEmptyContrib","getAttribution","hasNoContrib","removeLayer","filtredActivities","dX","dS","dE","forEach","summary_polyline","coords","polyline","decode","setStyle","color","bounds","fitBounds","aggreg","val","handleChangeD1","value","handleChangeD2","lastActivityDate","lastBatch","created_at","Math","floor","time","addActivities","catch","error","timeEnd","floatButton","disabled","form","dates","min","onChange","Object","entries","v","ref","App","setToken","err","setErr","search","get","history","pushState","reload","message","getUserData","getStoredData","Provider","unAuthorizeAsync","align","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.f87bef3c.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"chartSection\":\"styles_chartSection__8DmAr\",\"chartSectionHeader\":\"styles_chartSectionHeader__2tvOG\",\"chart\":\"styles_chart__2Uc27\",\"daysName\":\"styles_daysName__1EwFv\",\"main\":\"styles_main__7eyzD\",\"container\":\"styles_container__1TRtf\",\"empty_point\":\"styles_empty_point__2GnNm\",\"point\":\"styles_point__38Ssf\",\"monthsBar\":\"styles_monthsBar__6batd\",\"month\":\"styles_month__71ham\",\"m1\":\"styles_m1__7kJDC\",\"m2\":\"styles_m2__3EOHO\",\"m3\":\"styles_m3__2zK2c\",\"m4\":\"styles_m4__5NGeg\",\"m5\":\"styles_m5__3oxQC\",\"m6\":\"styles_m6__1EZ14\"};","const client_id = 59766;\nconst client_secret = 'b7893c2f78225337f8ac6852e5c2fe313948c8f7';\nconst lsTokenKey = 'SportSeasonStravaTokenData';\nconst lsUserKey = 'SportSeasonStravaUserData';\n\nexport function getAuthLink() {\n    const data = {\n        client_id,\n        redirect_uri: window.location.origin,\n        response_type: 'code',\n        approval_prompt : 'auto',\n        scope: 'activity:read',\n        //state: ''\n    };\n\n    const searchParams = new URLSearchParams(data);\n\n    return `https://www.strava.com/oauth/authorize?${searchParams.toString()}`;\n}\n\nexport async function getAuthTokenAsync() {\n    const lsTokenDataStr = localStorage.getItem(lsTokenKey);\n\n    if (lsTokenDataStr && lsTokenDataStr.length) {\n        const tData = JSON.parse(lsTokenDataStr);\n        if (tData.expires_at && tData.expires_at * 1000 > Date.now()) {\n            return tData.access_token;\n        }\n\n        if (tData.refresh_token) {\n            try {\n                const result = await fetch(\"https://www.strava.com/api/v3/oauth/token\", {\n                    body: new URLSearchParams({\n                        client_id,\n                        client_secret,\n                        refresh_token: tData.refresh_token,\n                        grant_type: 'refresh_token'\n                    }).toString(),\n                    headers: {\n                        \"Content-Type\": \"application/x-www-form-urlencoded\"\n                    },\n                    method: \"POST\"\n                }).then(res => res.json());\n                localStorage.setItem(lsTokenKey, JSON.stringify(result));\n\n                return result.access_token;\n\n            } catch (error) {\n                throw new Error(error);\n            }\n        }\n\n        throw new Error('no token');\n    } else {\n        throw new Error('no stored token data');\n    }\n}\n\nexport async function setAuthTokenByCodeAsync(code) {\n    try {\n        const result = await fetch(\"https://www.strava.com/api/v3/oauth/token\", {\n            body: new URLSearchParams({\n                client_id,\n                client_secret,\n                code,\n                grant_type: 'authorization_code'\n            }).toString(),\n            headers: {\n                \"Content-Type\": \"application/x-www-form-urlencoded\"\n            },\n            method: \"POST\"\n        }).then(res => res.json());\n\n        console.log({result})\n        const { athlete, ...tokenData } = result;\n\n        localStorage.setItem(lsUserKey, JSON.stringify(athlete));\n        localStorage.setItem(lsTokenKey, JSON.stringify(tokenData));\n\n        return result.access_token;\n\n    } catch (error) {\n        throw new Error(error);\n    }\n\n}\n\nexport async function unAuthorizeAsync(){\n    const access_token = '';\n    try {\n        await fetch(\n            `https://www.strava.com/oauth/deauthorize?${new URLSearchParams({ access_token }).toString()}`,\n            { method: \"POST\" }\n            ).then(res => res.json());\n        localStorage.removeItem(lsTokenKey);\n        localStorage.removeItem(lsUserKey);\n\n        return Promise.resolve({ success: true });\n    } catch (error) {\n        throw new Error(error);\n    }\n}\n\nexport function getUser() {\n    return JSON.parse(localStorage.getItem(lsUserKey));\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { getUser } from '../../services/authService';\nimport styles from './styles.module.css';\n\nconst Profile = (props) => {\n    const user = getUser();\n    return <div className={styles.prof}>\n        <img src={user.profile_medium} className={styles.ava} />\n        <div className={styles.name}>\n            {user.lastname}\n            <strong>{user.firstname}</strong>\n        </div>\n    </div>;\n};\n\nProfile.propTypes = {};\n\nexport default Profile;\n","import { openDB } from 'idb/with-async-ittr.js';\n\nclass LocalDb {\n    constructor(name, version) {\n        this.init(name, version)\n    }\n\n    async init(name, version) {\n        this.db = await openDB(name, version, {\n            upgrade(db) {\n                db.createObjectStore('activities', { keyPath: 'id' })\n                    .createIndex('start_date', 'start_date');\n            },\n        });\n    }\n\n    addActivities(oneOrSeveralObjs) {\n        let tx = this.db.transaction('activities', 'readwrite');\n        let store = tx.objectStore('activities');\n        if (Array.isArray(oneOrSeveralObjs)) {\n            return Promise.all([\n                ...oneOrSeveralObjs.map(obj => tx.store.add(obj)),\n                tx.done\n            ]);\n        }\n        return tx.add('activities', oneOrSeveralObjs)\n    }\n\n    getAllActivity() {\n        let tx = this.db.transaction('activities');\n        let store = tx.objectStore('activities');\n        return store.getAll();\n    }\n}\n\nconst dbName = 'stravastat';\nconst dbVersion = 1;\n\n\nconst instance = new LocalDb(dbName, dbVersion);\nexport default instance;\n","export async function getActivitiesAsync(token, t1, t2, page = 1, limit=100) {\n    return await fetch(`https://www.strava.com/api/v3/athlete/activities?before=${t2}&after=${t1}&page=${page}&per_page=${limit}`, {\n        headers: {\n            Authorization: `Bearer ${token}`\n        }\n    }).then(res => res.json());\n}\n","export function formatDistance(d, destructure = false) {\n    if (!d) { return '-'; }\n    const parts = d > 1000\n        ? [parseFloat(d / 1000).toFixed(2), 'км']\n        : [parseFloat(d).toFixed(2), 'м'];\n\n    return destructure ? parts : parts.join('\\u202f');\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { act } from '@testing-library/react';\nimport { formatDistance } from '../../../../helpers/formatHelper';\nimport styles from './styles.module.css';\n\nconst ActivityItem = ({ activity }) => {\n\n    const t1 = Date.parse(activity.start_date_local) - (activity.utc_offset * 1000)\n    const d1 = new Date(t1);\n    const d2 = new Date(t1 + (activity.elapsed_time * 1000));\n    const at = new Date((activity.moving_time - activity.utc_offset ) * 1000);\n\n    return <a href={`https://www.strava.com/activities/${activity.id}`} target={'_blank'} className={styles.item}>\n        <div className={styles.row}>\n            <strong>{activity.name}</strong>\n            <strong>{formatDistance(activity.distance)}</strong>\n        </div>\n\n        <small>{d1.toLocaleString().substr(0,17)}\n        -\n        {d1.toLocaleDateString() !== d2.toLocaleDateString() && d2.toLocaleDateString()}\n        {d2.toLocaleTimeString().substr(0,5)},\n            в движении: {at.toLocaleTimeString().substr(0,5)}</small>\n        <br/>\n        Высота макс: {activity.elev_high}, мин: {activity.elev_low};\n        {' '}\n        {activity.average_heartrate && <>Пульс: средн: {activity.average_heartrate}, макс: {activity.max_heartrate};</>}\n        {' '}\n        Средняя скорость {activity.average_speed};\n    </a>\n    ;\n};\n\nActivityItem.propTypes = {\n    activity: PropTypes.shape({\n/*\n* achievement_count: 0\nathlete: {id: 12602406, resource_state: 1}\nathlete_count: 2\naverage_cadence: 46.2\naverage_heartrate: 109.6\naverage_speed: 1.15\ncomment_count: 0\ncommute: false\ndisplay_hide_heartrate_option: true\ndistance: 15153.2\nelapsed_time: 19210\nelev_high: 268.6\nelev_low: 171.1\nend_latlng: (2) [53.22, 44.91]\nexternal_id: \"b1046a83-5025-48bc-81a6-ff2ed5ebf35b-activity.fit\"\nflagged: false\nfrom_accepted_tag: false\ngear_id: \"g6417986\"\nhas_heartrate: true\nhas_kudoed: false\nheartrate_opt_out: false\nid: 5872168321\nkudos_count: 7\nlocation_city: null\nlocation_country: \"Russia\"\nlocation_state: null\nmanual: false\nmap: {id: \"a5872168321\", summary_polyline: \"gfzcIyicqGSNJQE_AHAMGDI_@wAEeBN}@\\\\u@KyAjAO@]LM?eCJ…BLu@Km@EoIOq@GeBi@YM}@KMmAV]ZMKGe@a@i@EeAJQlANEh@\", resource_state: 2}\nmax_heartrate: 148\nmax_speed: 4\nmoving_time: 13179\nname: \"Полуденная ходьба\"\nphoto_count: 0\npr_count: 0\nprivate: false\nresource_state: 2\nstart_date: \"2021-08-29T08:14:02Z\"\nstart_date_local: \"2021-08-29T11:14:02Z\"\nstart_latitude: 53.22\nstart_latlng: (2) [53.22, 44.91]\nstart_longitude: 44.91\ntimezone: \"(GMT+03:00) Europe/Moscow\"\ntotal_elevation_gain: 189.2\ntotal_photo_count: 16\ntrainer: false\ntype: \"Walk\"\nupload_id: 6243513574\nupload_id_str: \"6243513574\"\nutc_offset: 10800\nvisibility: \"everyone\"\n\n* */\n    }).isRequired,\n};\n\nexport default ActivityItem;\n","let debounceTimeout;\r\nexport const debounceAsync = (duration = 600) => {\r\n    clearTimeout(debounceTimeout);\r\n\r\n    return new Promise(resolve => {\r\n        debounceTimeout = setTimeout(() => resolve(), duration);\r\n    });\r\n}","import React from 'react';\nimport styles from './styles.module.css';\nimport PropTypes from 'prop-types';\n\nconst Card = ({title, children, unit}) => {\n    return <div className={styles.card}>\n        <h3 className={styles.cardTitle}>{title}</h3>\n        <div className={styles.cardContent}>{children}{unit && <>&thinsp;<small>{unit}</small></>}</div>\n    </div>;\n};\n\nCard.propTypes = {};\n\nexport default Card;\n","import { createContext } from 'react';\nexport const UserContext = createContext(null);\n","import styles from './styles.module.css';\r\nimport {useEffect} from \"react\";\r\nimport * as ReactDOM from \"react-dom\";\r\nconst Modal = ({ children, onClose }) => {\r\n    useEffect(() => {\r\n        document.body.style.overflow = 'hidden';\r\n        return () => document.body.style.overflow = '';\r\n    }, []);\r\n\r\n    return <div className={styles.overlay} onClick={onClose}>\r\n        <div className={styles.modal} onClick={e => e.stopPropagation()}>\r\n            {children}\r\n        </div>\r\n    </div>\r\n}\r\n\r\nexport const showModal = props => {\r\n    const container = document.createElement('div');\r\n    document.body.appendChild(container);\r\n\r\n    ReactDOM.render(<Modal {...props} onClose={() => document.body.removeChild(container)} />, container)\r\n}\r\n\r\nexport default Modal;","import styles from './styles.module.css';\r\nimport React, {useEffect, useState} from \"react\";\r\nimport {formatDistance} from \"../../helpers/formatHelper\";\r\nimport {debounceAsync} from \"../../helpers/debounceHelper\";\r\nimport {showModal} from \"../Modal\";\r\nimport ActivityItem from \"../Activities/components/ActivityItem\";\r\n\r\nconst showDay = (x) => {\r\n    // window.confirm([formatDistance(x.dist), ...x.acts.map(x => '• ' + x.name)].join('\\n'))\r\n    showModal({children: <div>\r\n            {x.acts.map(a => <ActivityItem key={a.id} activity={a} />)}\r\n        </div>})\r\n}\r\n\r\nconst Chart = ({activities}) => {\r\n    const [size, setSize] = useState(+localStorage.getItem('stravastatZoom') || 14);\r\n\r\n\r\n    useEffect(async () => localStorage.setItem('stravastatZoom', size), [size]);\r\n\r\n    if(!activities[0]) {\r\n        return '🐱‍🚀';\r\n    }\r\n\r\n    const minD = new Date(Date.parse(activities[0].start_date));\r\n    const maxD = new Date(Date.parse(activities[activities.length - 1].start_date));\r\n    const shif = minD.getDay() === 0 ? 6 : minD.getDay()-1\r\n\r\n    const agg = [];\r\n    const mo = [];\r\n    let cur = minD.getTime();\r\n    let w=0;\r\n    while (cur < maxD.getTime()) {\r\n        const actual = activities.filter(x => {\r\n            return new Date(Date.parse(x.start_date)).toISOString().substr(0,10) === new Date(cur).toISOString().substr(0,10)\r\n        });\r\n\r\n        if (new Date(cur).getDay() === 6) {\r\n            w += 1;\r\n        }\r\n\r\n        if (new Date(cur).getMonth() !== new Date(cur+86_400_000).getMonth()) {\r\n            mo.push({ m: new Date(cur).toISOString().substr(0,7), w })\r\n            w = 0;\r\n        }\r\n        agg.push({ date: cur, cou: actual.length, acts: actual, dist: actual.reduce((s,x)=>x.distance + s,0) });\r\n\r\n        cur += 86_400_000;\r\n    }\r\n    mo.push({ m: new Date(cur).toISOString().substr(0,7),w})\r\n    w = 0;\r\n\r\n    const filledActivities = agg.filter(x => x.dist > 0);\r\n    const min = filledActivities.reduce((prev, curr) => prev.dist < curr.dist ? prev.dist : curr.dist);\r\n    const max = filledActivities.reduce((prev, curr) => prev.dist > curr.dist ? prev.dist : curr.dist);\r\n\r\n    const handleZoom = coeff => async () => {\r\n        await debounceAsync(300);\r\n        setSize(cur => cur + coeff)\r\n    }\r\n\r\n\r\n    return <section  className={styles.chartSection}>\r\n        <header className={styles.chartSectionHeader}>\r\n            <h3>Карта активности</h3>\r\n            <div>\r\n                <button onClick={handleZoom(2)}>\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\"\r\n                         className=\"bi bi-zoom-in\" viewBox=\"0 0 16 16\">\r\n                        <path fill-rule=\"evenodd\"\r\n                              d=\"M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z\"/>\r\n                        <path\r\n                            d=\"M10.344 11.742c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1 6.538 6.538 0 0 1-1.398 1.4z\"/>\r\n                        <path fill-rule=\"evenodd\"\r\n                              d=\"M6.5 3a.5.5 0 0 1 .5.5V6h2.5a.5.5 0 0 1 0 1H7v2.5a.5.5 0 0 1-1 0V7H3.5a.5.5 0 0 1 0-1H6V3.5a.5.5 0 0 1 .5-.5z\"/>\r\n                    </svg>\r\n                </button>\r\n                <button onClick={handleZoom(-2)}>\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\"\r\n                         className=\"bi bi-zoom-out\" viewBox=\"0 0 16 16\">\r\n                        <path fill-rule=\"evenodd\"\r\n                              d=\"M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z\"/>\r\n                        <path\r\n                            d=\"M10.344 11.742c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1 6.538 6.538 0 0 1-1.398 1.4z\"/>\r\n                        <path fill-rule=\"evenodd\" d=\"M3 6.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z\"/>\r\n                    </svg>\r\n                </button>\r\n            </div>\r\n        </header>\r\n        <div className={styles.chart} style={{ fontSize: size + 'px' }}>\r\n        <div className={styles.daysName}>\r\n            <div><small>пн</small></div>\r\n            <div><small>вт</small></div>\r\n            <div><small>ср</small></div>\r\n            <div><small>чт</small></div>\r\n            <div><small>пт</small></div>\r\n            <div><small>сб</small></div>\r\n            <div><small>вс</small></div>\r\n        </div>\r\n        <div className={styles.main}>\r\n            <div className={styles.monthsBar}>\r\n                {mo.map(m => <div key={m.m} className={styles.month + ' '+styles['m'+m.w]}>\r\n                <small>{m.m}</small>\r\n            </div>)}</div>\r\n            <div className={styles.container}>\r\n                {shif> 0 && new Array(shif).fill(true).map((a,x) => <div key={x} className={styles.empty_point} />)}\r\n                {agg.map((x, i) => {\r\n                    return <div\r\n                        title={new Date(x.date)} className={x.cou>0 ? styles.point:styles.empty_point}\r\n                        key={x.date}\r\n                        style={x.dist > 0 ? {backgroundColor:`rgba(252,82,0,${(x.dist / max)})`}:{}}\r\n                        onClick={x.dist > 0 ? () => showDay(x) : () => {} }\r\n                    >\r\n                        <small>\r\n                            {new Date(x.date).getDate()}\r\n                        </small>\r\n                    </div>\r\n                })}\r\n            </div>\r\n        </div>\r\n    </div></section>\r\n}\r\n\r\n/*\r\n* achievement_count: 0\r\nathlete: {id: 12602406, resource_state: 1}\r\nathlete_count: 8\r\naverage_speed: 1.164\r\ncomment_count: 0\r\ncommute: false\r\ndisplay_hide_heartrate_option: false\r\ndistance: 13919.9\r\nelapsed_time: 22384\r\nelev_high: 344\r\nelev_low: 232.4\r\nend_latlng: (2) [53.03, 46.98]\r\nexternal_id: \"???? 3.gpx\"\r\nflagged: false\r\nfrom_accepted_tag: false\r\ngear_id: \"g3242449\"\r\nhas_heartrate: false\r\nhas_kudoed: false\r\nheartrate_opt_out: false\r\nid: 1948748704\r\nkudos_count: 4\r\nlocation_city: null\r\nlocation_country: \"Russia\"\r\nlocation_state: null\r\nmanual: false\r\nmap: {id: \"a1948748704\", summary_polyline: \"apibI}y_}GlATS{Ai@fIiB}Du@|@qAqNiIuEsBuDkFaAcBqDoD…qDU}JnBypAaC_I`Cw`@qJDNyEcC}@gE|BkAuLnCa@}MgAoEsM\", resource_state: 2}\r\nmax_speed: 2.1\r\nmoving_time: 11963\r\nname: \"Ноябрррьский поход 2018. День 3\"\r\nphoto_count: 0\r\npr_count: 0\r\nprivate: false\r\nresource_state: 2\r\nstart_date: \"2018-11-04T06:58:34Z\"\r\nstart_date_local: \"2018-11-04T09:58:34Z\"\r\nstart_latitude: 52.97\r\nstart_latlng: (2) [52.97, 46.86]\r\nstart_longitude: 46.98\r\ntimezone: \"(GMT+03:00) Europe/Moscow\"\r\ntotal_elevation_gain: 201.4\r\ntotal_photo_count: 4\r\ntrainer: false\r\ntype: \"Hike\"\r\nupload_id: 2084826025\r\nupload_id_str: \"2084826025\"\r\nutc_offset: 10800\r\nvisibility: \"everyone\"\r\n\r\n* */\r\n\r\nexport default Chart;","import Card from \"../Card\";\r\nimport {formatDistance} from \"../../../../helpers/formatHelper\";\r\nimport React from \"react\";\r\n\r\nconst Widget = ({ distance, elev_high, elev_low, moving_time }) => {\r\n    const [d, dU] = formatDistance(distance, true);\r\n    const [h, hU] = formatDistance(elev_high, true);\r\n    const [l, lU] = formatDistance(elev_low, true);\r\n\r\n    return <section style={{ display: 'flex', marginTop: '10px', padding:'10px'}}>\r\n        <Card title={'Дистанция'} unit={dU}>{d}</Card>\r\n        <Card title={'Набор'} unit={hU}>{h}</Card>\r\n        <Card title={'Сброс'} unit={lU}>{l}</Card>\r\n        <Card title={'В движении'} unit=\"ч\">{(moving_time / 60 / 60).toFixed(2)}</Card>\r\n    </section>\r\n}\r\n\r\nexport default Widget;","import React, { useEffect, useState, useRef, useContext } from 'react';\nimport PropTypes from 'prop-types';\nimport * as L from 'leaflet';\nimport polyline from '@mapbox/polyline';\nimport localDB from '../../services/indexedDBService';\nimport { getActivitiesAsync } from '../../services/activitiesService';\nimport ActivityItem from './components/ActivityItem';\nimport { formatDistance } from '../../helpers/formatHelper';\nimport { clearMap } from '../../helpers/mapHelper';\nimport Card from './components/Card';\nimport styles from './styles.module.css'\nimport { UserContext } from '../../contexts/userContext';\nimport Chart from \"../Chart\";\nimport {debounceAsync} from \"../../helpers/debounceHelper\";\nimport Widget from \"./components/Widget\";\nimport Modal from \"../Modal\";\nconst now = new Date();\nconst defaultD1 = new Date(now.getFullYear(), 0, 1, 4, 0, 0, 1);\nconst defaultD2 = new Date(now.getFullYear(), 11, 31, 23, 59, 59, 999);\n\nconst Activities = ({ token }) => {\n    const [d1, setD1] = useState(localStorage.getItem('stravastatD1') || defaultD1.toISOString().substr(0,10));\n    const [d2, setD2] = useState(localStorage.getItem('stravastatD2') || defaultD2.toISOString().substr(0,10));\n    const [types, setTypes] = useState([]);\n    const [loading, setIsLoading] = useState(false);\n    const [type, setType] = useState(localStorage.getItem('stravastatType') || \"\");\n    const [activities, setActivities] = useState(null);\n    const mapRef = useRef();\n    const mapContainerRef = useRef();\n    const user = useContext(UserContext);\n\n    useEffect(() => {\n        localDB.getAllActivity().then(res => {\n            setActivities(res);\n            if (!res.length) {\n                handleUpdate();\n            }\n        });\n    }, []);\n\n    useEffect(async () => localStorage.setItem('stravastatD1', d1), [d1]);\n    useEffect(async () => localStorage.setItem('stravastatD2', d2), [d2]);\n    useEffect(() => localStorage.setItem('stravastatType', type), [type])\n\n    useEffect(() => {\n        activities?.length && setTypes(activities.reduce((acc, {type}) => ({...acc, [type]: (acc[type] || 0) + 1}), {}));\n    }, [activities]);\n\n    useEffect(()=> {\n        if (!mapContainerRef?.current) {\n            return;\n        }\n\n        if (!mapRef?.current) {\n            mapRef.current = L.map(\n                mapContainerRef.current,\n                { fullscreenControl: true }\n            ).setView([53.2006600, 45.0046400], 12);\n\n            L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n                attribution: 'Map data © <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors',\n                maxZoom: 20,\n                id: 'osm'\n            }).addTo(mapRef.current);\n        }\n\n\n\n        const boundCoordinates = [];\n\n        clearMap(mapRef.current);\n        const filtredActivities = activities && activities.filter(x => {\n            const dX = Date.parse(x.start_date_local);\n            const dS = Date.parse(d1);\n            const dE = Date.parse(d2);\n\n            return (!type || x.type === type) && dX >= dS && dX <= dE;\n        });\n        filtredActivities?.forEach(({ map: {summary_polyline} }) => {\n            if (summary_polyline?.length) {\n                const coords = polyline.decode(summary_polyline);\n                L.polyline(coords).setStyle({\n                    color: 'rgba(255, 0, 0,0.5)'\n                }).addTo(mapRef.current)\n                boundCoordinates.push(coords)\n            }\n        })\n\n        const bounds = L.latLngBounds(boundCoordinates);\n        boundCoordinates?.length && mapRef.current.fitBounds(bounds);// works!\n\n    }, [mapContainerRef.current, activities, type, d1, d2]);\n\n\n    const filtredActivities = activities && activities.filter(x => {\n        const dX = Date.parse(x.start_date_local);\n        const dS = Date.parse(d1);\n        const dE = Date.parse(d2);\n\n        return (!type || x.type === type) && dX >= dS && dX <= dE;\n    })\n    const aggreg = filtredActivities?.reduce((acc, val) => {\n        return {\n            distance: acc.distance + val.distance,\n            elev_high: acc.elev_high + val.elev_high || 0,\n            elev_low: acc.elev_low + val.elev_low || 0,\n            elapsed_time: acc.elapsed_time + val.elapsed_time,\n            moving_time: acc.moving_time + val.moving_time\n        };\n    }, { distance: 0, elev_high: 0, elev_low: 0, elapsed_time: 0, moving_time: 0 })\n\n    let debounceTimer;\n    const handleChangeD1 = async (e) => { const value = e.target.value; await debounceAsync(); setD1(value); }\n    const handleChangeD2 = async (e) => { const value = e.target.value; await debounceAsync(); setD2(value); }\n    const limit = 50;\n\n    async function handleUpdate() {\n        setIsLoading(true);\n        let lastBatch = activities;\n        let lastActivityDate = lastBatch?.length\n            ? new Date(Date.parse(lastBatch[lastBatch.length - 1].start_date))\n            : new Date(Date.parse(user.created_at));\n\n        let page = 0;\n        while (page === 0 || lastBatch?.length > 0) {\n            page++;\n            console.log('page', page);\n\n            lastBatch = await getActivitiesAsync(\n                token,\n                Math.floor(lastActivityDate.getTime() / 1000),\n                Math.floor(new Date().getTime() / 1000),\n                page,\n                limit\n            );\n\n            console.time('addDB');\n            await localDB.addActivities(lastBatch).catch(e => console.error(e));\n            console.timeEnd('addDB');\n        }\n\n        setIsLoading(false)\n    };\n\n    return <div>\n        <button className={styles.floatButton} disabled={loading} onClick={handleUpdate}>\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" viewBox=\"0 0 16 16\">\n                <path\n                    d=\"M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z\"/>\n                <path d=\"M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z\"/>\n            </svg>\n        </button>\n        <div className={styles.form}>\n            <div className={styles.dates}><input\n                type=\"date\"\n                value={d1}\n                min={user.created_at.substr(0,10)}\n                max={d2.substr(0,10)}\n                onChange={handleChangeD1}\n            />\n            -\n            <input\n                type=\"date\"\n                value={d2}\n                min={d1.substr(0,10)}\n                max={new Date().toISOString().substr(0,10)}\n                onChange={handleChangeD2}\n            />\n            </div>\n            {' \\u00a0 '}\n            <select onChange={e => setType(e.target.value)} value={type}>\n                <option value=\"\">Все виды активностей</option>\n                {types && Object.entries(types).map(([x,v]) => (\n                    <option key={x} value={x}>{x} ({v})</option>\n                ))}\n            </select>\n        </div>\n        {\n            aggreg && <Widget\n                distance={aggreg.distance}\n                elev_high={aggreg.elev_high}\n                elev_low={aggreg.elev_low}\n                moving_time={aggreg.moving_time}\n            />\n        }\n        {filtredActivities?.length > 0 && <Chart activities={filtredActivities} />}\n        {!activities && 'loading...'}\n        {filtredActivities && <div ref={mapContainerRef} style={{height:'300px'}}/>}\n        <section>\n            {filtredActivities && filtredActivities.map(x => <ActivityItem key={x.id} activity={x} /> )}\n        </section>\n    </div>;\n};\n\nActivities.propTypes = {\n    token: PropTypes.string,\n};\n\nexport default Activities;\n","export function clearMap(map) {\n    map.eachLayer((layer) => {\n        const hasEmptyContrib = !(layer.getAttribution && layer.getAttribution());\n        const hasNoContrib = !layer.getAttribution;\n        if (hasEmptyContrib || hasNoContrib) {\n            map.removeLayer(layer);\n        }\n    })\n}\n","import { useEffect, useState } from 'react';\nimport './App.css';\nimport {\n    getAuthLink,\n    getAuthTokenAsync,\n    setAuthTokenByCodeAsync,\n    unAuthorizeAsync,\n    getUser\n} from './services/authService';\nimport Profile from './components/Profile';\nimport Activities from './components/Activities';\nimport { UserContext } from './contexts/userContext';\n\n\nfunction App() {\n    const [token, setToken] = useState(null);\n    const [err, setErr] = useState(null);\n    useEffect(() => {\n        const params = new URLSearchParams(window.location.search);\n        const code = params.get('code');\n\n        if(code?.length) {\n            const getUserData = async () => {\n                try {\n                    await setAuthTokenByCodeAsync(code);\n                    window.history.pushState({},'', '/');\n                    window.location.reload();\n                    //window.location.href = window.location.href.replace(window.location.search, '');\n                } catch (e) {\n                    setErr(e.message)\n                    window.location.href = getAuthLink();\n                }\n            }\n            return getUserData();\n        } else {\n            const getStoredData = async () => {\n                try {\n                    const token = await getAuthTokenAsync();\n                    setToken(token);\n                } catch (e) {\n                    console.log(e)\n                    //window.location.href = getAuthLink();\n                }\n            }\n\n            getStoredData();\n        }\n\n    }, []);\n\n  return (\n    <div className=\"App\">\n        {err && <p>{err}</p>}\n        {token && <UserContext.Provider value={getUser()}>\n            <header className=\"header\">\n                <Profile />\n                <button onClick={() => unAuthorizeAsync().then(() => window.location.reload())}>Выйти</button>\n            </header>\n            <Activities token={token} />\n        </UserContext.Provider>}\n        {!token && <section className=\"hello\">\n            <p align=\"center\">\n                Это приложение покажет<br />\n                статистику ваших активностей<br />\n                в новом виде 😎\n                <br />\n                <br />\n                Для продолжения нужно\n            <br />\n            <button  className=\"bigButton\" onClick={() => window.location.href = getAuthLink()}>Войти в Strava</button>\n            </p>\n            </section>}\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"ava\":\"styles_ava__3g67r\",\"prof\":\"styles_prof__2-c8f\",\"name\":\"styles_name__3BqxZ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"card\":\"styles_card__1Zhz5\",\"cardTitle\":\"styles_cardTitle__2lbDP\",\"cardContent\":\"styles_cardContent__2_jID\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"form\":\"styles_form__3iSXe\",\"dates\":\"styles_dates__tZmqb\",\"floatButton\":\"styles_floatButton__17FMM\",\"rotation\":\"styles_rotation__2Fv_j\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"item\":\"styles_item__1z28u\",\"row\":\"styles_row__aRxr4\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"overlay\":\"styles_overlay__3eQZi\",\"modal\":\"styles_modal__2irQs\"};"],"sourceRoot":""}
{"version":3,"sources":["services/authService.js","components/Profile/index.js","services/indexedDBService.js","services/activitiesService.js","helpers/formatHelper.js","components/Activities/components/ActivityItem/index.js","components/Activities/components/Card/index.js","contexts/userContext.js","components/Activities/index.js","helpers/mapHelper.js","App.js","index.js","components/Profile/styles.module.css","components/Activities/components/Card/styles.module.css","components/Activities/styles.module.css"],"names":["client_id","client_secret","lsTokenKey","lsUserKey","getAuthLink","data","redirect_uri","window","location","origin","response_type","approval_prompt","scope","searchParams","URLSearchParams","toString","getAuthTokenAsync","a","lsTokenDataStr","localStorage","getItem","length","tData","JSON","parse","expires_at","Date","now","access_token","refresh_token","fetch","body","grant_type","headers","method","then","res","json","result","setItem","stringify","Error","setAuthTokenByCodeAsync","code","console","log","athlete","tokenData","removeItem","Promise","resolve","success","getUser","Profile","props","user","className","styles","prof","src","profile_medium","ava","name","lastname","firstname","instance","version","this","init","openDB","upgrade","db","createObjectStore","keyPath","createIndex","oneOrSeveralObjs","tx","transaction","objectStore","Array","isArray","all","map","obj","store","add","done","getAll","getActivitiesAsync","token","t1","t2","page","limit","Authorization","formatDistance","d","parseFloat","toFixed","ActivityItem","activity","start_date_local","utc_offset","d1","d2","elapsed_time","at","moving_time","href","id","target","distance","toLocaleString","substr","toLocaleDateString","toLocaleTimeString","elev_high","elev_low","average_heartrate","max_heartrate","average_speed","speed","Card","title","children","card","cardTitle","cardContent","UserContext","createContext","defaultD1","getFullYear","defaultD2","Activities","useState","toISOString","setD1","setD2","types","setTypes","loading","setIsLoading","type","setType","activities","setActivities","mapRef","useRef","mapContainerRef","useContext","useEffect","localDB","getAllActivity","reduce","acc","current","L","fullscreenControl","setView","attribution","maxZoom","addTo","boundCoordinates","eachLayer","layer","hasEmptyContrib","getAttribution","hasNoContrib","removeLayer","filtredActivities","filter","x","dX","dS","dE","forEach","summary_polyline","coords","polyline","decode","setStyle","color","push","bounds","fitBounds","aggreg","val","handleUpdate","lastActivityDate","lastBatch","start_date","created_at","Math","floor","getTime","time","addActivities","catch","e","error","timeEnd","floatButton","disabled","onClick","xmlns","width","height","fill","viewBox","form","value","min","max","onChange","Object","entries","v","style","display","ref","App","setToken","search","get","replace","getUserData","getStoredData","Provider","unAuthorizeAsync","reload","ReactDOM","render","StrictMode","document","getElementById","module","exports"],"mappings":"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","file":"static/js/main.dd8139c1.chunk.js","sourcesContent":["const client_id = 59766;\r\nconst client_secret = 'b7893c2f78225337f8ac6852e5c2fe313948c8f7';\r\nconst lsTokenKey = 'SportSeasonStravaTokenData';\r\nconst lsUserKey = 'SportSeasonStravaUserData';\r\n\r\nexport function getAuthLink() {\r\n    const data = {\r\n        client_id,\r\n        redirect_uri: window.location.origin,\r\n        response_type: 'code',\r\n        approval_prompt : 'auto',\r\n        scope: 'activity:read',\r\n        //state: ''\r\n    };\r\n\r\n    const searchParams = new URLSearchParams(data);\r\n\r\n    return `https://www.strava.com/oauth/authorize?${searchParams.toString()}`;\r\n}\r\n\r\nexport async function getAuthTokenAsync() {\r\n    const lsTokenDataStr = localStorage.getItem(lsTokenKey);\r\n\r\n    if (lsTokenDataStr && lsTokenDataStr.length) {\r\n        const tData = JSON.parse(lsTokenDataStr);\r\n        if (tData.expires_at && tData.expires_at * 1000 > Date.now()) {\r\n            return tData.access_token;\r\n        }\r\n\r\n        if (tData.refresh_token) {\r\n            try {\r\n                const result = await fetch(\"https://www.strava.com/api/v3/oauth/token\", {\r\n                    body: new URLSearchParams({\r\n                        client_id,\r\n                        client_secret,\r\n                        refresh_token: tData.refresh_token,\r\n                        grant_type: 'refresh_token'\r\n                    }).toString(),\r\n                    headers: {\r\n                        \"Content-Type\": \"application/x-www-form-urlencoded\"\r\n                    },\r\n                    method: \"POST\"\r\n                }).then(res => res.json());\r\n                localStorage.setItem(lsTokenKey, JSON.stringify(result));\r\n\r\n                return result.access_token;\r\n\r\n            } catch (error) {\r\n                throw new Error(error);\r\n            }\r\n        }\r\n\r\n        throw new Error('no token');\r\n    } else {\r\n        throw new Error('no stored token data');\r\n    }\r\n}\r\n\r\nexport async function setAuthTokenByCodeAsync(code) {\r\n    try {\r\n        const result = await fetch(\"https://www.strava.com/api/v3/oauth/token\", {\r\n            body: new URLSearchParams({\r\n                client_id,\r\n                client_secret,\r\n                code,\r\n                grant_type: 'authorization_code'\r\n            }).toString(),\r\n            headers: {\r\n                \"Content-Type\": \"application/x-www-form-urlencoded\"\r\n            },\r\n            method: \"POST\"\r\n        }).then(res => res.json());\r\n\r\n        console.log({result})\r\n        const { athlete, ...tokenData } = result;\r\n\r\n        localStorage.setItem(lsUserKey, JSON.stringify(athlete));\r\n        localStorage.setItem(lsTokenKey, JSON.stringify(tokenData));\r\n\r\n        return result.access_token;\r\n\r\n    } catch (error) {\r\n        throw new Error(error);\r\n    }\r\n\r\n}\r\n\r\nexport async function unAuthorizeAsync(){\r\n    const access_token = '';\r\n    try {\r\n        await fetch(\r\n            `https://www.strava.com/oauth/deauthorize?${new URLSearchParams({ access_token }).toString()}`,\r\n            { method: \"POST\" }\r\n            ).then(res => res.json());\r\n        localStorage.removeItem(lsTokenKey);\r\n        localStorage.removeItem(lsUserKey);\r\n\r\n        return Promise.resolve({ success: true });\r\n    } catch (error) {\r\n        throw new Error(error);\r\n    }\r\n}\r\n\r\nexport function getUser() {\r\n    return JSON.parse(localStorage.getItem(lsUserKey));\r\n}\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { getUser } from '../../services/authService';\r\nimport styles from './styles.module.css';\r\n\r\nconst Profile = (props) => {\r\n    const user = getUser();\r\n    return <div className={styles.prof}>\r\n        <img src={user.profile_medium} className={styles.ava} />\r\n        <div className={styles.name}>\r\n            {user.lastname}\r\n            <strong>{user.firstname}</strong>\r\n        </div>\r\n    </div>;\r\n};\r\n\r\nProfile.propTypes = {};\r\n\r\nexport default Profile;\r\n","import { openDB } from 'idb/with-async-ittr.js';\r\n\r\nclass LocalDb {\r\n    constructor(name, version) {\r\n        this.init(name, version)\r\n    }\r\n\r\n    async init(name, version) {\r\n        this.db = await openDB(name, version, {\r\n            upgrade(db) {\r\n                db.createObjectStore('activities', { keyPath: 'id' })\r\n                    .createIndex('start_date', 'start_date');\r\n            },\r\n        });\r\n    }\r\n\r\n    addActivities(oneOrSeveralObjs) {\r\n        let tx = this.db.transaction('activities', 'readwrite');\r\n        let store = tx.objectStore('activities');\r\n        if (Array.isArray(oneOrSeveralObjs)) {\r\n            return Promise.all([\r\n                ...oneOrSeveralObjs.map(obj => tx.store.add(obj)),\r\n                tx.done\r\n            ]);\r\n        }\r\n        return tx.add('activities', oneOrSeveralObjs)\r\n    }\r\n\r\n    getAllActivity() {\r\n        let tx = this.db.transaction('activities');\r\n        let store = tx.objectStore('activities');\r\n        return store.getAll();\r\n    }\r\n}\r\n\r\nconst dbName = 'stravastat';\r\nconst dbVersion = 1;\r\n\r\n\r\nconst instance = new LocalDb(dbName, dbVersion);\r\nexport default instance;\r\n","export async function getActivitiesAsync(token, t1, t2, page = 1, limit=100) {\r\n    return await fetch(`https://www.strava.com/api/v3/athlete/activities?before=${t2}&after=${t1}&page=${page}&per_page=${limit}`, {\r\n        headers: {\r\n            Authorization: `Bearer ${token}`\r\n        }\r\n    }).then(res => res.json());\r\n}\r\n","export function formatDistance(d) {\r\n    if (!(d > 0)) { return '-'; }\r\n    return d > 1000 ? `${parseFloat(d / 1000).toFixed(2)}\\u202fкм` : `${parseFloat(d).toFixed()}\\u2009м`;\r\n}\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { act } from '@testing-library/react';\r\nimport { formatDistance } from '../../../../helpers/formatHelper';\r\n\r\nconst ActivityItem = ({ activity }) => {\r\n\r\n    const t1 = Date.parse(activity.start_date_local) - (activity.utc_offset * 1000)\r\n    const d1 = new Date(t1);\r\n    const d2 = new Date(t1 + (activity.elapsed_time * 1000));\r\n    const at = new Date((activity.moving_time - activity.utc_offset ) * 1000);\r\n\r\n    return <div>\r\n        <a href={`https://www.strava.com/activities/${activity.id}`} target={'_blank'}>{activity.name}</a>\r\n        <strong>{formatDistance(activity.distance)}</strong>\r\n        {d1.toLocaleString().substr(0,17)}\r\n        -\r\n        {d1.toLocaleDateString() !== d2.toLocaleDateString() && d2.toLocaleDateString()}\r\n        {d2.toLocaleTimeString().substr(0,5)}\r\n        (движ: {at.toLocaleTimeString().substr(0,5)})\r\n        <br/>\r\n        {activity.elev_high}/{activity.elev_low} {activity.average_heartrate}/{activity.max_heartrate} {activity.average_speed}/{activity.speed}\r\n    </div>;\r\n};\r\n\r\nActivityItem.propTypes = {\r\n    activity: PropTypes.shape({\r\n/*\r\n* achievement_count: 0\r\nathlete: {id: 12602406, resource_state: 1}\r\nathlete_count: 2\r\naverage_cadence: 46.2\r\naverage_heartrate: 109.6\r\naverage_speed: 1.15\r\ncomment_count: 0\r\ncommute: false\r\ndisplay_hide_heartrate_option: true\r\ndistance: 15153.2\r\nelapsed_time: 19210\r\nelev_high: 268.6\r\nelev_low: 171.1\r\nend_latlng: (2) [53.22, 44.91]\r\nexternal_id: \"b1046a83-5025-48bc-81a6-ff2ed5ebf35b-activity.fit\"\r\nflagged: false\r\nfrom_accepted_tag: false\r\ngear_id: \"g6417986\"\r\nhas_heartrate: true\r\nhas_kudoed: false\r\nheartrate_opt_out: false\r\nid: 5872168321\r\nkudos_count: 7\r\nlocation_city: null\r\nlocation_country: \"Russia\"\r\nlocation_state: null\r\nmanual: false\r\nmap: {id: \"a5872168321\", summary_polyline: \"gfzcIyicqGSNJQE_AHAMGDI_@wAEeBN}@\\\\u@KyAjAO@]LM?eCJ…BLu@Km@EoIOq@GeBi@YM}@KMmAV]ZMKGe@a@i@EeAJQlANEh@\", resource_state: 2}\r\nmax_heartrate: 148\r\nmax_speed: 4\r\nmoving_time: 13179\r\nname: \"Полуденная ходьба\"\r\nphoto_count: 0\r\npr_count: 0\r\nprivate: false\r\nresource_state: 2\r\nstart_date: \"2021-08-29T08:14:02Z\"\r\nstart_date_local: \"2021-08-29T11:14:02Z\"\r\nstart_latitude: 53.22\r\nstart_latlng: (2) [53.22, 44.91]\r\nstart_longitude: 44.91\r\ntimezone: \"(GMT+03:00) Europe/Moscow\"\r\ntotal_elevation_gain: 189.2\r\ntotal_photo_count: 16\r\ntrainer: false\r\ntype: \"Walk\"\r\nupload_id: 6243513574\r\nupload_id_str: \"6243513574\"\r\nutc_offset: 10800\r\nvisibility: \"everyone\"\r\n\r\n* */\r\n    }).isRequired,\r\n};\r\n\r\nexport default ActivityItem;\r\n","import React from 'react';\r\nimport styles from './styles.module.css';\r\nimport PropTypes from 'prop-types';\r\n\r\nconst Card = ({title, children}) => {\r\n    return <div className={styles.card}>\r\n        <div className={styles.cardTitle}>{title}</div>\r\n        <div className={styles.cardContent}>{children}</div>\r\n    </div>;\r\n};\r\n\r\nCard.propTypes = {};\r\n\r\nexport default Card;\r\n","import { createContext } from 'react';\r\nexport const UserContext = createContext(null);\r\n","import React, { useEffect, useState, useRef, useContext } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport * as L from 'leaflet';\r\nimport polyline from '@mapbox/polyline';\r\nimport localDB from '../../services/indexedDBService';\r\nimport { getActivitiesAsync } from '../../services/activitiesService';\r\nimport ActivityItem from './components/ActivityItem';\r\nimport { formatDistance } from '../../helpers/formatHelper';\r\nimport { clearMap } from '../../helpers/mapHelper';\r\nimport Card from './components/Card';\r\nimport styles from './styles.module.css'\r\nimport { UserContext } from '../../contexts/userContext';\r\nconst now = new Date();\r\nconst defaultD1 = new Date(now.getFullYear(), 0, 1, 4, 0, 0, 1);\r\nconst defaultD2 = new Date(now.getFullYear(), 11, 31, 23, 59, 59, 999);\r\n\r\nconst Activities = ({ token }) => {\r\n    const [d1, setD1] = useState(localStorage.getItem('stravastatD1') || defaultD1.toISOString().substr(0,10));\r\n    const [d2, setD2] = useState(localStorage.getItem('stravastatD2') || defaultD2.toISOString().substr(0,10));\r\n    const [types, setTypes] = useState([]);\r\n    const [loading, setIsLoading] = useState(false);\r\n    const [type, setType] = useState(localStorage.getItem('stravastatType'));\r\n    const [activities, setActivities] = useState(null);\r\n    const mapRef = useRef();\r\n    const mapContainerRef = useRef();\r\n    const user = useContext(UserContext);\r\n\r\n    useEffect(() => {\r\n        localDB.getAllActivity().then(res => {\r\n            console.log(res);\r\n            setActivities(res);\r\n        });\r\n    }, []);\r\n\r\n    useEffect(() => localStorage.setItem('stravastatD1', d1), [d1]);\r\n    useEffect(() => localStorage.setItem('stravastatD2', d2), [d2]);\r\n    useEffect(() => localStorage.setItem('stravastatType', type), [type])\r\n\r\n    useEffect(() => {\r\n        activities?.length && setTypes(activities.reduce((acc, {type}) => ({...acc, [type]: (acc[type] || 0) + 1}), {}));\r\n    }, [activities]);\r\n\r\n    useEffect(()=> {\r\n        if (!mapContainerRef?.current) {\r\n            return;\r\n        }\r\n\r\n        if (!mapRef?.current) {\r\n            mapRef.current = L.map(\r\n                mapContainerRef.current,\r\n                { fullscreenControl: true }\r\n            ).setView([53.2006600, 45.0046400], 12);\r\n\r\n            L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n                attribution: 'Map data © <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors',\r\n                maxZoom: 20,\r\n                id: 'osm'\r\n            }).addTo(mapRef.current);\r\n        }\r\n\r\n\r\n\r\n        const boundCoordinates = [];\r\n\r\n        clearMap(mapRef.current);\r\n        const filtredActivities = activities && activities.filter(x => {\r\n            const dX = Date.parse(x.start_date_local);\r\n            const dS = Date.parse(d1);\r\n            const dE = Date.parse(d2);\r\n\r\n            return (!type || x.type === type) && dX >= dS && dX <= dE;\r\n        });\r\n        filtredActivities?.forEach(({ map: {summary_polyline} }) => {\r\n            if (summary_polyline?.length) {\r\n                const coords = polyline.decode(summary_polyline);\r\n                L.polyline(coords).setStyle({\r\n                    color: 'rgba(255, 0, 0,0.5)'\r\n                }).addTo(mapRef.current)\r\n                boundCoordinates.push(coords)\r\n            }\r\n        })\r\n\r\n        const bounds = L.latLngBounds(boundCoordinates);\r\n        boundCoordinates?.length && mapRef.current.fitBounds(bounds);// works!\r\n\r\n    }, [mapContainerRef.current, activities, type, d1, d2]);\r\n\r\n\r\n    const filtredActivities = activities && activities.filter(x => {\r\n        const dX = Date.parse(x.start_date_local);\r\n        const dS = Date.parse(d1);\r\n        const dE = Date.parse(d2);\r\n\r\n        return (!type || x.type === type) && dX >= dS && dX <= dE;\r\n    })\r\n    const aggreg = filtredActivities?.reduce((acc, val) => {\r\n        return {\r\n            distance: acc.distance + val.distance,\r\n            elev_high: acc.elev_high + val.elev_high || 0,\r\n            elev_low: acc.elev_low + val.elev_low || 0,\r\n            elapsed_time: acc.elapsed_time + val.elapsed_time,\r\n            moving_time: acc.moving_time + val.moving_time\r\n        };\r\n    }, { distance: 0, elev_high: 0, elev_low: 0, elapsed_time: 0, moving_time: 0 })\r\n\r\n    let handleChangeD1 = (e) => setD1(e.target.value);\r\n    let handleChangeD2 = (e) => setD2(e.target.value);\r\n    const limit = 50;\r\n\r\n    const handleUpdate = async () => {\r\n        setIsLoading(true);\r\n        let lastBatch = activities;\r\n        let lastActivityDate = lastBatch?.length\r\n            ? new Date(Date.parse(lastBatch[lastBatch.length - 1].start_date))\r\n            : new Date(Date.parse(user.created_at));\r\n\r\n        let page = 0;\r\n        while (page === 0 || lastBatch?.length > 0) {\r\n            page++;\r\n            console.log('page', page);\r\n\r\n            lastBatch = await getActivitiesAsync(\r\n                token,\r\n                Math.floor(lastActivityDate.getTime() / 1000),\r\n                Math.floor(new Date().getTime() / 1000),\r\n                page,\r\n                limit\r\n            );\r\n\r\n            console.time('addDB');\r\n            await localDB.addActivities(lastBatch).catch(e => console.error(e));\r\n            console.timeEnd('addDB');\r\n        }\r\n\r\n        setIsLoading(false)\r\n    };\r\n\r\n    return <div>\r\n        <button className={styles.floatButton} disabled={loading} onClick={handleUpdate}>\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\"\r\n                 className=\"bi bi-arrow-repeat\" viewBox=\"0 0 16 16\">\r\n                <path\r\n                    d=\"M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z\"/>\r\n                <path fill-rule=\"evenodd\"\r\n                      d=\"M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z\"/>\r\n            </svg>\r\n        </button>\r\n        <div className={styles.form}>\r\n            <input\r\n                type=\"date\"\r\n                value={d1}\r\n                min={user.created_at.substr(0,10)}\r\n                max={d2.substr(0,10)}\r\n                onChange={handleChangeD1}\r\n            />\r\n            -\r\n            <input\r\n                type=\"date\"\r\n                value={d2}\r\n                min={d1.substr(0,10)}\r\n                max={new Date().toISOString().substr(0,10)}\r\n                onChange={handleChangeD2}\r\n            />\r\n            {' \\u00a0 '}\r\n            <select onChange={e => setType(e.target.value)} value={type}>\r\n                <option value=\"\">Все виды активностей</option>\r\n                {types && Object.entries(types).map(([x,v]) => (\r\n                    <option key={x} value={x}>{x} ({v})</option>\r\n                ))}\r\n            </select>\r\n        </div>\r\n        {aggreg && <section style={{display:'flex', 'margin':'10px auto'}}>\r\n            <Card title={'Дистанция'}>{formatDistance(aggreg.distance)}</Card>\r\n            <Card title={'Набор'}>{formatDistance(aggreg.elev_high)}</Card>\r\n            <Card title={'Сброс'}>{formatDistance(aggreg.elev_low)}</Card>\r\n            <Card title={'В движении'}>{(aggreg.moving_time / 60 / 60).toFixed(2)} ч</Card>\r\n        </section>\r\n        }\r\n        {!activities && 'loading...'}\r\n        {filtredActivities && <div ref={mapContainerRef} style={{height:'300px'}}/>}\r\n        <ul>\r\n            {filtredActivities && filtredActivities.map(x => <ActivityItem key={x.id} activity={x} /> )}\r\n        </ul>\r\n    </div>;\r\n};\r\n\r\nActivities.propTypes = {\r\n    token: PropTypes.string,\r\n};\r\n\r\nexport default Activities;\r\n","export function clearMap(map) {\r\n    map.eachLayer((layer) => {\r\n        const hasEmptyContrib = !(layer.getAttribution && layer.getAttribution());\r\n        const hasNoContrib = !layer.getAttribution;\r\n        if (hasEmptyContrib || hasNoContrib) {\r\n            map.removeLayer(layer);\r\n        }\r\n    })\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport './App.css';\r\nimport {\r\n    getAuthLink,\r\n    getAuthTokenAsync,\r\n    setAuthTokenByCodeAsync,\r\n    unAuthorizeAsync,\r\n    getUser\r\n} from './services/authService';\r\nimport Profile from './components/Profile';\r\nimport Activities from './components/Activities';\r\nimport { UserContext } from './contexts/userContext';\r\n\r\n\r\nfunction App() {\r\n    const [token, setToken] = useState(null);\r\n    useEffect(() => {\r\n        const params = new URLSearchParams(window.location.search);\r\n        const code = params.get('code');\r\n\r\n        if(code?.length) {\r\n            const getUserData = async () => {\r\n                try {\r\n                    await setAuthTokenByCodeAsync(code);\r\n                    window.location.href = window.location.href.replace(window.location.search, '');\r\n                } catch (e) {\r\n                    window.location.href = getAuthLink();\r\n                }\r\n            }\r\n            return getUserData();\r\n        } else {\r\n            const getStoredData = async () => {\r\n                try {\r\n                    const token = await getAuthTokenAsync();\r\n                    setToken(token);\r\n                } catch (e) {\r\n                    console.log(e)\r\n                    //window.location.href = getAuthLink();\r\n                }\r\n            }\r\n\r\n            getStoredData();\r\n        }\r\n\r\n    }, []);\r\n\r\n  return (\r\n    <div className=\"App\">\r\n        {token && <UserContext.Provider value={getUser()}>\r\n            <header className=\"header\">\r\n                <Profile />\r\n                <button onClick={() => unAuthorizeAsync().then(() => window.location.reload())}>Выйти</button>\r\n            </header>\r\n            <Activities token={token} />\r\n        </UserContext.Provider>}\r\n        {!token && <button onClick={() => window.location.href = getAuthLink()}>Войти</button>}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"ava\":\"styles_ava__3uCq3\",\"prof\":\"styles_prof__xcgdj\",\"name\":\"styles_name__LOOD9\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"card\":\"styles_card__2aJrc\",\"cardTitle\":\"styles_cardTitle__QB308\",\"cardContent\":\"styles_cardContent__77HFA\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"form\":\"styles_form__3wXzo\",\"floatButton\":\"styles_floatButton__k3PFU\",\"rotation\":\"styles_rotation__RGWBT\"};"],"sourceRoot":""}